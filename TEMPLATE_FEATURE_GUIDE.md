# 문자 템플릿 기능 가이드

## ✅ 구현 완료

### 1. 데이터베이스 스키마
- `message_templates` 테이블 생성
- 템플릿 이름, 내용, 카테고리, 사용 횟수, 즐겨찾기 등 저장
- `tasks` 테이블에 `template_id` 컬럼 추가

### 2. 변수 치환 시스템
다음 변수들을 자동으로 치환합니다:

- **{고객명}** - 고객 이름
- **{날짜}** - 오늘 날짜 (YYYY-MM-DD 형식)
- **{시간}** - 현재 시간 (HH:MM 형식)
- **{전화번호}** - 고객 전화번호 (자동 포맷팅)
- **{업종}** - 고객 업종 (일반, 자동차, 보험 등)
- **{그룹명}** - 고객이 속한 그룹 이름
- **{태그}** - 고객의 첫 번째 태그
- **{생일}** - 고객 생일
- **{기념일}** - 고객 기념일
- **{요일}** - 오늘 요일 (일요일, 월요일 등)

### 3. 템플릿 관리 페이지 (`/dashboard/templates`)
- 템플릿 목록 조회
- 템플릿 추가/수정/삭제
- 카테고리별 분류 (일반, 생일, 기념일, 인사, 공지, 프로모션)
- 즐겨찾기 기능
- 사용 횟수 추적
- 변수 자동 감지 및 표시

### 4. 문자 보내기 페이지 개선 (`/dashboard/send`)
- 템플릿 선택 드롭다운 추가
- 템플릿 선택 시 메시지 자동 입력
- 고객 검색 기능 추가 (다중 발송 모드)
- 모든 변수 자동 치환
- 실시간 미리보기

---

## 📋 데이터베이스 마이그레이션 필요

**중요:** 템플릿 기능을 사용하려면 먼저 데이터베이스 마이그레이션을 실행해야 합니다.

### 마이그레이션 방법

1. **Supabase Dashboard 접속**
   - https://supabase.com/dashboard
   - 프로젝트 선택

2. **SQL Editor 열기**
   - 왼쪽 메뉴에서 "SQL Editor" 클릭

3. **마이그레이션 실행**
   - `supabase/add-message-templates.sql` 파일 열기
   - 전체 내용 복사
   - SQL Editor에 붙여넣기
   - "Run" 버튼 클릭

4. **확인**
   - "Table Editor"에서 `message_templates` 테이블이 생성되었는지 확인

---

## 🎯 사용 방법

### 템플릿 만들기

1. `/dashboard/templates` 페이지 접속
2. "+ 템플릿 추가" 버튼 클릭
3. 템플릿 이름 입력 (예: "생일 축하")
4. 카테고리 선택
5. 메시지 내용 입력 (변수 사용 가능)
   - 예: `{고객명}님, 생일을 진심으로 축하드립니다! {날짜}에 특별한 하루 되세요! 🎉`
6. "추가" 버튼 클릭

### 템플릿 사용하기

1. `/dashboard/send` 페이지 접속
2. 발송 방식 선택 (단건/다중/그룹별/태그별)
3. 고객 선택
4. "템플릿 선택" 드롭다운에서 템플릿 선택
   - 선택하면 메시지가 자동으로 입력됨
5. 필요시 메시지 수정
6. 미리보기 확인
7. 발송 작업 생성

### 변수 사용 예시

**템플릿 내용:**
```
{고객명}님 안녕하세요!
오늘은 {날짜} {요일}입니다.
{그룹명} 그룹의 특별한 혜택을 안내드립니다.
```

**실제 발송 시:**
```
홍길동님 안녕하세요!
오늘은 2024-12-05 목요일입니다.
VIP 그룹의 특별한 혜택을 안내드립니다.
```

---

## 💡 팁

1. **즐겨찾기 활용**
   - 자주 쓰는 템플릿은 즐겨찾기로 표시
   - 템플릿 목록 상단에 표시됨

2. **카테고리 활용**
   - 생일, 기념일 등 용도별로 분류
   - 나중에 필터링 가능

3. **변수 조합**
   - 여러 변수를 조합하여 개인화된 메시지 작성
   - 예: `{고객명}님, {업종} 업계에서 {그룹명} 그룹의 특별 회원이십니다!`

4. **고객 검색**
   - 다중 발송 모드에서 고객 이름이나 전화번호로 빠르게 검색
   - 대량 발송 시 유용

---

## 🔧 기술 세부사항

### 파일 구조
```
web/src/
├── lib/
│   ├── types/
│   │   └── template.ts          # 템플릿 타입 정의
│   ├── utils/
│   │   └── templateParser.ts    # 변수 치환 로직
│   └── hooks/
│       └── useMessageTemplates.ts # 템플릿 관리 훅
└── app/
    └── dashboard/
        ├── templates/
        │   └── page.tsx          # 템플릿 관리 페이지
        └── send/
            └── page.tsx          # 문자 보내기 페이지 (개선됨)
```

### 데이터베이스 스키마
```sql
CREATE TABLE message_templates (
    id UUID PRIMARY KEY,
    user_id UUID NOT NULL,
    name VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    category VARCHAR(50),
    variables TEXT[],
    usage_count INTEGER DEFAULT 0,
    is_favorite BOOLEAN DEFAULT false,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

---

## ✅ 체크리스트

- [ ] 데이터베이스 마이그레이션 실행 (`supabase/add-message-templates.sql`)
- [ ] 템플릿 관리 페이지 접속 확인 (`/dashboard/templates`)
- [ ] 템플릿 추가 테스트
- [ ] 문자 보내기 페이지에서 템플릿 선택 테스트
- [ ] 변수 치환 확인 (미리보기)
- [ ] 고객 검색 기능 테스트 (다중 발송 모드)

---

## 🐛 문제 해결

### 템플릿이 보이지 않아요
- 데이터베이스 마이그레이션이 실행되었는지 확인
- Supabase Dashboard에서 `message_templates` 테이블 확인

### 변수가 치환되지 않아요
- 변수 이름이 정확한지 확인 (대소문자, 중괄호 포함)
- 고객 정보가 제대로 로드되었는지 확인
- 미리보기에서 확인 (실제 발송 시에는 자동 치환됨)

### 템플릿 선택이 안 돼요
- 템플릿이 등록되어 있는지 확인
- 브라우저 콘솔에서 에러 확인

