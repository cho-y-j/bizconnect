# BizConnect AI 콜백 서비스 마스터 플랜

**작성일**: 2025-12-08
**마지막 업데이트**: 2025-12-09
**버전**: 2.0

---

## 📌 핵심 콘셉트

### 서비스 정의
- **간결하고 특징 있는 콜백 + 웹 고객 관리 문자 서비스**
- 전화 종료 후 자동으로 맞춤 문자 발송
- 카테고리별 차별화된 발송 (가족/친구는 안 보냄, 거래처는 AI 맞춤)
- 기본 = 인사말 + 명함 이미지

### 차별화 포인트

| 경쟁사 | BizConnect |
|--------|------------|
| 고정 템플릿 | **카테고리별 차별화** |
| 텍스트만 | **인사말 + 명함 이미지** |
| 매번 같은 문자 | **AI로 매번 다른 문자** (옵션) |
| 앱에서만 설정 | **웹+앱 통합 관리** |
| 월정액 필수 | **무료 시작 (199건/일)** |

---

## 🔄 콜백 발송 흐름도

```
📞 전화 이벤트 발생
        │
        ├─────────────────────────────────────┐
        │                                     │
        ▼                                     ▼
   [통화 종료]              [부재중]         [통화중 거절]
        │                     │                  │
        ▼                     ▼                  ▼
┌───────────────────────────────────────────────────────┐
│            콜백 설정 확인 (user_settings)              │
│  - 통화종료 메시지 ON/OFF + 템플릿                      │
│  - 부재중 메시지 ON/OFF + 템플릿                        │
│  - 통화중 메시지 ON/OFF + 템플릿                        │
│  - 명함 이미지 첨부 ON/OFF                             │
│  - AI 발송 ON/OFF                                     │
└───────────────────────┬───────────────────────────────┘
                        │
                        ▼
        ┌───────────────────────────────┐
        │ 1. 전화번호로 고객 검색 (DB)   │
        └───────────────┬───────────────┘
                        │
              ┌─────────┴─────────┐
              ▼                   ▼
         고객 있음            고객 없음
              │                   │
              ▼                   ▼
    ┌──────────────────┐   ┌──────────────┐
    │ 카테고리 확인     │   │ 신규 고객     │
    │ (웹에서 분류됨)   │   │ 기본 템플릿   │
    └────────┬─────────┘   └──────┬───────┘
             │                    │
             ▼                    │
    ┌────────────────────────┐    │
    │ 가족/친구 → 발송 안 함  │    │
    │ 거래처/VIP → AI 맞춤    │    │
    │ 일반 고객 → 기본 템플릿 │    │
    │ 미분류 → 기본 템플릿    │    │
    └────────────┬───────────┘    │
                 │                │
                 ▼                ▼
         ┌─────────────────────────────┐
         │     메시지 생성              │
         │  1. 기본: 설정된 템플릿       │
         │  2. AI: 기존 대화 기반 생성   │
         └──────────────┬──────────────┘
                        │
                        ▼
         ┌─────────────────────────────┐
         │  명함 이미지 첨부 여부 확인   │
         │  - ON: MMS로 발송            │
         │  - OFF: SMS로 발송           │
         └──────────────┬──────────────┘
                        │
                        ▼
         ┌─────────────────────────────┐
         │      문자 발송 완료          │
         │   (발송 기록 DB 저장)        │
         └─────────────────────────────┘
```

---

## 📊 데이터 흐름

### 1. 고객 데이터 흐름
```
[휴대폰 주소록] ──(앱에서 업로드)──> [Supabase customers 테이블]
                                           │
                                           ▼
                              [웹에서 카테고리 분류]
                                           │
                                           ▼
                              [앱에서 카테고리 확인 후 발송]
```

### 2. 문자 데이터 흐름
```
[발송된 문자] ──(기록)──> [Supabase sms_logs 테이블]
                                   │
                                   ▼
[수신된 문자] ──(향후)──> [문자 이력 통합 관리]
                                   │
                                   ▼
                         [AI가 대화 이력 분석]
                                   │
                                   ▼
                         [맞춤 문자 생성에 활용]
```

---

## 🎛️ 3가지 콜백 옵션

### 옵션 설정 UI (앱)

| 옵션 | ON/OFF | 메시지 템플릿 | 설명 |
|------|--------|--------------|------|
| **통화 종료 후** | ✅/❌ | 편집 가능 | 정상 통화 후 발송 |
| **부재중** | ✅/❌ | 편집 가능 | 못 받았을 때 발송 |
| **통화중 거절** | ✅/❌ | 편집 가능 | 바빠서 거절했을 때 발송 |
| **명함 이미지** | ✅/❌ | 이미지 선택 | 모든 문자에 첨부 |
| **AI 맞춤 발송** | ✅/❌ | - | 거래처/VIP에 적용 |

### 기본 메시지 (아무것도 설정 안 했을 때)
```
안녕하세요, 방금 통화 감사합니다.
궁금하신 점 있으시면 편하게 연락주세요.
```

### 옵션별 기본 템플릿

**통화 종료:**
```
안녕하세요, {{내이름}}입니다.
방금 통화 감사합니다.
궁금하신 점 있으시면 편하게 연락주세요.
```

**부재중:**
```
안녕하세요, {{내이름}}입니다.
전화를 받지 못해 죄송합니다.
확인 후 다시 연락드리겠습니다.
```

**통화중:**
```
안녕하세요, {{내이름}}입니다.
통화중이라 받지 못했습니다.
잠시 후 연락드리겠습니다.
```

---

## 📁 카테고리별 설정

| 카테고리 | 콜백 발송 | 발송 방식 | 비고 |
|----------|----------|----------|------|
| **가족** | ❌ 안 함 | - | 자동 제외 |
| **친구** | ❌ 안 함 | - | 자동 제외 |
| **거래처** | ✅ 발송 | AI 맞춤 | 기존 대화 기반 |
| **VIP 고객** | ✅ 발송 | AI 맞춤 | 특별 인사 |
| **일반 고객** | ✅ 발송 | 기본 템플릿 | 설정된 문구 |
| **신규 (미등록)** | ✅ 발송 | 기본 템플릿 | 첫인사 |
| **미분류** | ✅ 발송 | 기본 템플릿 | 설정된 문구 |

---

## 🖥️ 웹 vs 앱 역할 분담

| 기능 | 앱 | 웹 |
|------|:--:|:--:|
| **콜백 ON/OFF** | ✅ | ✅ |
| **3가지 옵션 설정** | ✅ | ✅ |
| **메시지 템플릿 편집** | ✅ | ✅ |
| **명함 이미지 설정** | ✅ (업로드) | ✅ |
| **주소록 업로드** | ✅ | ❌ |
| **고객 카테고리 분류** | ⚡ 간단 | ✅ 상세 |
| **고객 추가/수정** | ⚡ 간단 | ✅ 상세 |
| **발송 이력 보기** | ⚡ 요약 | ✅ 상세 |
| **문자 대화 이력** | ⚡ 보기 | ✅ 상세 |
| **AI 질문하기** | ✅ | ✅ |
| **전화 감지 + 발송** | ✅ | ❌ |

---

## 🔧 기술 스택

### 앱 (React Native)
- react-native-call-detection: 통화 감지
- react-native-get-sms-android: SMS 발송
- react-native-contacts: 주소록 접근
- @supabase/supabase-js: DB 연동

### 웹 (Next.js)
- Next.js 14: 웹 프레임워크
- Supabase: 인증 + DB
- Vercel: 호스팅

### 백엔드
- Supabase: PostgreSQL + Auth + Realtime
- DeepSeek API: AI 문자 생성

---

## 📅 개발 로드맵

### ✅ Phase 0: 기반 구축 (완료)
- [x] 자동 로그인 구현
- [x] 웹 설정 바로가기 버튼
- [x] 통화 감지 기능
- [x] 기본 SMS 발송

### 🔥 Phase 1: 핵심 콜백 기능 (현재 - 오늘)
- [x] 통화 종료 후 기본 문자 발송 (2025-12-09 완료!)
- [ ] 3가지 콜백 옵션 (통화종료/부재중/통화중)
- [ ] 사용자 설정 메시지 발송
- [ ] 명함 이미지 MMS 발송
- [ ] user_settings DB 연동

### 📱 Phase 2: 고객 관리 (다음 단계)
- [ ] 주소록 → DB 업로드 기능 수정
- [ ] 웹에서 고객 카테고리 분류
- [ ] 앱에서 카테고리 확인
- [ ] 카테고리별 발송 여부 자동 판단

### 🤖 Phase 3: AI 연동
- [ ] AI 맞춤 문자 API 연동 (거래처/VIP)
- [ ] 기존 대화 이력 저장
- [ ] AI 질문 기능 ("이 고객과 무슨 얘기했지?")

### 📊 Phase 4: 통계 및 완성
- [ ] 발송 통계 대시보드
- [ ] 웹-앱 설정 완전 동기화
- [ ] 안정화 및 테스트

### 💰 Phase 5: 수익화 (추후)
- [ ] 알리고 API 연동 (199건 초과 시)
- [ ] 프리미엄 요금제

---

## 💵 수익 모델

| 플랜 | 가격 | 포함 기능 |
|------|------|----------|
| **무료** | 0원 | 199건/일, 기본 콜백, 명함 첨부 |
| **프로** | 월 9,900원 | 무제한*, AI 맞춤, 상세 통계 |
| **비즈니스** | 월 29,900원 | 다중 기기, 팀 관리, API 연동 |

*무제한 = 통신사 무료 문자 + 초과분 알리고 API

---

## 🗄️ DB 스키마 (핵심)

### user_settings
```sql
- user_id
- auto_callback_enabled (전체 ON/OFF)
-- 통화종료 옵션
- callback_on_end_enabled (통화종료 ON/OFF)
- callback_on_end_message (통화종료 메시지)
- callback_on_end_image_url (통화종료 전용 이미지)
-- 부재중 옵션
- callback_on_missed_enabled (부재중 ON/OFF)
- callback_on_missed_message (부재중 메시지)
- callback_on_missed_image_url (부재중 전용 이미지)
-- 통화중 옵션
- callback_on_busy_enabled (통화중 ON/OFF)
- callback_on_busy_message (통화중 메시지)
- callback_on_busy_image_url (통화중 전용 이미지)
-- 기본 명함 (개별 이미지 없을 때 사용)
- business_card_enabled (기본 명함 ON/OFF)
- business_card_image_url (기본 명함 이미지 URL)
- ai_callback_enabled (AI 발송 ON/OFF)
```

### 이미지 우선순위 로직
1. 각 옵션별 개별 이미지가 있으면 그것 사용 (`callback_on_xxx_image_url`)
2. 개별 이미지 없고 `business_card_enabled=true`면 기본 명함 사용
3. 둘 다 없으면 이미지 없이 SMS로 발송

### customers
```sql
- id, user_id
- name, phone
- group_id (카테고리)
- birthday, anniversary
- notes
```

### customer_groups
```sql
- id, user_id
- name (가족, 친구, 거래처, VIP 등)
- callback_enabled (이 그룹에 콜백 발송 여부)
- use_ai (이 그룹에 AI 사용 여부)
```

### sms_logs
```sql
- id, user_id
- customer_id, phone_number
- message, status (sent/failed)
- type (callback_end/callback_missed/callback_busy)
- sent_at
```

---

## 🎯 오늘 (2025-12-09) 목표

1. **3가지 콜백 옵션 구현**
   - 통화 종료 후 메시지
   - 부재중 메시지
   - 통화중 메시지

2. **사용자 설정 메시지 발송**
   - user_settings에서 템플릿 불러오기
   - 없으면 기본 메시지 발송

3. **명함 이미지 MMS 발송**
   - 이미지 첨부 기능 구현
   - MMS 발송

---

**마지막 업데이트**: 2025-12-09 13:00
- 콜백 기본 발송 성공!
- Android 15 호환성 문제 해결
- SMS 라이브러리 Android 13+ 수정
- 3가지 콜백 옵션 구현 완료 (통화종료/부재중/통화중)
- 옵션별 개별 이미지 설정 기능 추가
