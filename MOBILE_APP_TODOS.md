# 📱 BizConnect 모바일 앱 개발 TODO

**작성일**: 2025년 1월 27일  
**목표**: 완전한 기능을 갖춘 모바일 앱 개발  
**예상 기간**: 3-4주

---

## 🎯 Phase 1: 핵심 기능 (필수) - Week 1-2

### 1. 프로젝트 설정 및 환경 구성
**우선순위**: ⭐⭐⭐ (최상위)  
**예상 소요**: 4-6시간

- [ ] React Native 프로젝트 초기화 확인
- [ ] 필요한 라이브러리 설치 및 버전 확인
  - [ ] `react-native-get-sms-android` (SMS 발송)
  - [ ] `react-native-call-detection` (통화 감지)
  - [ ] `react-native-contacts` (주소록 읽기)
  - [ ] `@react-native-async-storage/async-storage` (로컬 저장)
  - [ ] `@supabase/supabase-js` (백엔드 연동)
  - [ ] `react-native-permissions` (권한 관리)
  - [ ] `react-native-background-actions` (백그라운드 작업)
- [ ] Android 권한 설정 (`AndroidManifest.xml`)
  - [ ] `SEND_SMS` 권한
  - [ ] `READ_PHONE_STATE` 권한
  - [ ] `READ_CALL_LOG` 권한
  - [ ] `READ_CONTACTS` 권한 (주소록 업로드용 - 필수)
  - [ ] `RECEIVE_SMS` 권한 (선택)
- [ ] Supabase 연결 설정 확인
- [ ] TypeScript 설정 확인
- [ ] 개발 환경 테스트 (에뮬레이터/실제 디바이스)

---

### 2. 인증 시스템 구현
**우선순위**: ⭐⭐⭐  
**예상 소요**: 6-8시간

- [ ] Supabase Auth 연동
  - [ ] 로그인 화면 구현
  - [ ] 회원가입 화면 구현
  - [ ] 이메일/비밀번호 인증
  - [ ] 구글 OAuth 연동 (선택)
  - [ ] 자동 로그인 (세션 유지)
- [ ] 인증 상태 관리
  - [ ] 로그인 상태 확인
  - [ ] 로그아웃 기능
  - [ ] 세션 만료 처리
- [ ] 보안
  - [ ] 토큰 안전 저장
  - [ ] 자동 로그아웃 (보안)

---

### 3. 스로틀링 큐 시스템 구현
**우선순위**: ⭐⭐⭐ (가장 중요!)  
**예상 소요**: 10-12시간

#### 3.1 큐 관리 시스템
- [ ] `mobile/lib/smsQueue.ts` 생성
  - [ ] 큐 클래스 구현
  - [ ] 작업 추가/제거 로직
  - [ ] 큐 상태 관리 (대기/처리중/완료/실패)
  - [ ] 우선순위 처리 (priority 필드 활용)
- [ ] 스로틀링 로직
  - [ ] 5초 간격 타이머 구현
  - [ ] 큐에서 하나씩 순차 처리
  - [ ] 처리 중인 작업 추적
  - [ ] 동시 처리 방지 (락 메커니즘)
- [ ] 로컬 저장소 연동
  - [ ] AsyncStorage에 큐 저장
  - [ ] 앱 재시작 시 큐 복구
  - [ ] 큐 동기화 (Supabase와)

#### 3.2 예약 발송 처리
- [ ] `scheduled_at` 필드 확인
- [ ] 예약 시간 도래 시 자동 처리
- [ ] 예약 작업 필터링

#### 3.3 에러 처리 및 재시도
- [ ] 발송 실패 시 재시도 로직
  - [ ] 최대 재시도 횟수 설정 (3회)
  - [ ] 재시도 간격 설정 (5분)
  - [ ] 지수 백오프 (exponential backoff)
- [ ] 최종 실패 처리
  - [ ] tasks 테이블 상태 업데이트 ('failed')
  - [ ] 사용자에게 알림
- [ ] 네트워크 오류 처리
  - [ ] 오프라인 상태 감지
  - [ ] 오프라인 큐 저장
  - [ ] 온라인 복구 시 자동 재시도

---

### 4. 일일 한도 제어 시스템
**우선순위**: ⭐⭐⭐  
**예상 소요**: 6-8시간

- [ ] `mobile/lib/dailyLimit.ts` 생성
- [ ] 일일 한도 조회
  - [ ] `daily_limits` 테이블에서 오늘 한도 조회
  - [ ] 사용자 설정 확인 (안전 199건 / 최대 499건 월 10회 )
  - [ ] 한도 모드에 따른 제한 적용
- [ ] 발송 전 한도 체크
  - [ ] 큐에 추가 전 한도 확인
  - [ ] 한도 초과 시 큐 추가 차단
- [ ] 발송 후 카운트 업데이트
  - [ ] 발송 성공 시 `sent_count` 증가
  - [ ] `daily_limits` 테이블 업데이트
  - [ ] 실시간 동기화
- [ ] 한도 초과 처리
  - [ ] 사용자에게 알림 표시
  - [ ] 큐 처리 중단
  - [ ] 다음 날 자동 재개
- [ ] 한도 리셋 확인
  - [ ] 자정 자동 리셋 확인
  - [ ] 날짜 변경 감지

---

### 5. 실제 SMS 발송 처리
**우선순위**: ⭐⭐⭐  
**예상 소요**: 8-10시간

#### 5.1 SMS 발송 구현
- [ ] `mobile/lib/smsSender.ts` 생성
- [ ] 기본 SMS 발송
  - [ ] `react-native-get-sms-android` 활용
  - [ ] 전화번호 유효성 검사
  - [ ] 메시지 길이 체크 (SMS 90자, 장문 160자)
- [ ] MMS 발송 (이미지 첨부)
  - [ ] 이미지 다운로드 (Supabase Storage)
  - [ ] 이미지 크기 최적화
  - [ ] MMS 발송 처리
  - [ ] 발송 실패 시 재시도

#### 5.2 발송 기록 저장
- [ ] `sms_logs` 테이블에 기록
  - [ ] 발송 성공 시 'sent' 상태로 저장
  - [ ] 발송 실패 시 'failed' 상태로 저장
  - [ ] 에러 메시지 저장
  - [ ] SMS ID 저장 (선택)
- [ ] `tasks` 테이블 상태 업데이트
  - [ ] 'pending' → 'queued' → 'processing' → 'completed'
  - [ ] 실패 시 'failed' 상태
  - [ ] `completed_at` 타임스탬프 저장
- [ ] 실시간 동기화
  - [ ] Supabase에 즉시 반영
  - [ ] 오프라인 시 대기 후 동기화

#### 5.3 발송 확인 및 모니터링
- [ ] 발송 성공/실패 확인
- [ ] 발송 통계 수집
  - [ ] 오늘 발송 건수
  - [ ] 성공/실패 비율
  - [ ] 평균 발송 시간

---

### 6. Supabase 실시간 구독 구현
**우선순위**: ⭐⭐⭐  
**예상 소요**: 4-6시간

- [ ] tasks 테이블 실시간 구독
  - [ ] 새 작업 생성 시 알림 받기
  - [ ] 작업 상태 변경 감지
  - [ ] 사용자별 필터링 (user_id)
- [ ] 구독 최적화
  - [ ] 필요한 이벤트만 구독 (INSERT, UPDATE)
  - [ ] 메모리 누수 방지 (구독 해제)
  - [ ] 재연결 로직
- [ ] 오프라인 처리
  - [ ] 연결 끊김 감지
  - [ ] 재연결 시 누락된 작업 확인
  - [ ] 폴링 폴백 (선택)

---

## 🎯 Phase 2: 스마트 기능 - Week 2-3

### 7. 스마트 콜백 기능 구현
**우선순위**: ⭐⭐  
**예상 소요**: 10-12시간

#### 7.1 통화 감지
- [ ] `mobile/lib/callbackManager.ts` 생성
- [ ] 통화 종료 감지
  - [ ] `react-native-call-detection` 활용
  - [ ] 백그라운드에서도 동작
  - [ ] 통화 시간 기록 (선택)
- [ ] 전화번호 추출 및 정규화
  - [ ] 국가 코드 처리
  - [ ] 하이픈 제거
  - [ ] 유효성 검사

#### 7.2 고객 DB 조회
- [ ] 전화번호로 고객 검색
  - [ ] `customers` 테이블에서 조회
  - [ ] 전화번호 매칭 (정규화된 번호)
- [ ] 신규/기존 고객 판별
  - [ ] 고객 존재 여부 확인
  - [ ] 신규 고객 플래그 설정

#### 7.3 템플릿 적용 및 발송
- [ ] 사용자 설정 조회
  - [ ] `user_settings` 테이블에서 콜백 설정 확인
  - [ ] 콜백 활성화 여부 확인
- [ ] 템플릿 선택
  - [ ] 신규 고객: `callback_template_new`
  - [ ] 기존 고객: `callback_template_existing`
- [ ] 변수 치환
  - [ ] `{고객명}`, `{이름}`, `{회사명}` 등 치환
  - [ ] 템플릿 파서 활용
- [ ] 발송 처리
  - [ ] 자동 발송 vs 확인 후 발송 (설정에 따라)
  - [ ] 확인 후 발송 시 알림 표시
  - [ ] 사용자 승인 후 발송
- [ ] 발송 기록
  - [ ] tasks 테이블에 'callback' 타입으로 저장
  - [ ] sms_logs에 기록

#### 7.4 에러 처리
- [ ] 고객을 찾을 수 없을 때
  - [ ] 로그 기록
  - [ ] 사용자에게 알림 (선택)
- [ ] 템플릿이 없을 때
  - [ ] 기본 템플릿 사용
  - [ ] 사용자에게 알림
- [ ] 발송 실패 시
  - [ ] 재시도 로직
  - [ ] 사용자에게 알림

---

### 8. 주소록(연락처) 업로드 기능 구현
**우선순위**: ⭐⭐  
**예상 소요**: 8-10시간

#### 8.1 주소록 읽기 권한
- [ ] `READ_CONTACTS` 권한 요청
- [ ] 권한 거부 시 안내 메시지
- [ ] 권한 재요청 로직

#### 8.2 주소록 데이터 읽기
- [ ] `react-native-contacts` 라이브러리 설치 및 설정
- [ ] 주소록 전체 조회
- [ ] 필터링 옵션
  - [ ] 전체 연락처
  - [ ] 전화번호가 있는 연락처만
  - [ ] 선택한 연락처만
- [ ] 데이터 정규화
  - [ ] 전화번호 형식 통일 (하이픈 제거)
  - [ ] 이름 정리
  - [ ] 중복 제거

#### 8.3 데이터 변환 및 업로드
- [ ] 주소록 데이터를 고객 데이터 형식으로 변환
  - [ ] 이름 → name
  - [ ] 전화번호 → phone
  - [ ] 생일 (있는 경우) → birthday
  - [ ] 기타 정보 → notes
- [ ] CSV 형식으로 변환 (선택)
  - [ ] 웹 CSV 업로드 형식에 맞춤
  - [ ] 미리보기 제공
- [ ] Supabase에 직접 업로드
  - [ ] `customers` 테이블에 일괄 삽입
  - [ ] 중복 체크 (user_id, phone 기준)
  - [ ] upsert 사용 (기존 고객 업데이트)
- [ ] 업로드 진행률 표시
- [ ] 업로드 결과 표시
  - [ ] 성공한 건수
  - [ ] 실패한 건수
  - [ ] 중복된 건수

#### 8.4 UI 구현
- [ ] 주소록 선택 화면
  - [ ] 연락처 목록 표시
  - [ ] 체크박스로 다중 선택
  - [ ] 전체 선택/해제
  - [ ] 검색 기능
- [ ] 업로드 전 미리보기
  - [ ] 선택한 연락처 목록
  - [ ] 매핑된 데이터 확인
- [ ] 업로드 진행 화면
  - [ ] 진행률 바
  - [ ] 현재 처리 중인 연락처 표시
- [ ] 업로드 완료 화면
  - [ ] 결과 요약
  - [ ] 웹에서 확인하기 링크

#### 8.5 에러 처리
- [ ] 권한 거부 시 처리
- [ ] 주소록 읽기 실패 시 처리
- [ ] 업로드 실패 시 재시도 옵션
- [ ] 네트워크 오류 처리

---

### 9. 홈 화면 및 대시보드 구현
**우선순위**: ⭐⭐  
**예상 소요**: 8-10시간

#### 8.1 홈 화면 UI
- [ ] 오늘의 할 일 섹션
  - [ ] 오늘 생일인 고객 목록
  - [ ] 오늘 기념일인 고객 목록
  - [ ] 발송 대기 중인 작업 수
- [ ] 통계 카드
  - [ ] 오늘 발송 건수
  - [ ] 성공/실패 비율
  - [ ] 일일 한도 사용률
- [ ] 빠른 액션 버튼
  - [ ] 문자 보내기
  - [ ] 고객 관리
  - [ ] 발송 기록

#### 8.2 오늘의 할 일 데이터 로드
- [ ] 생일/기념일 조회
  - [ ] `customers` 테이블에서 오늘 날짜 조회
  - [ ] 월/일 기준 필터링
- [ ] 발송 대기 작업 조회
  - [ ] `tasks` 테이블에서 pending/queued 상태 조회
  - [ ] 예약 시간 순 정렬
- [ ] 실시간 업데이트
  - [ ] Supabase 실시간 구독
  - [ ] 자동 새로고침

#### 8.3 네비게이션
- [ ] React Navigation 설정
- [ ] 화면 구성
  - [ ] 홈 화면
  - [ ] 문자 보내기 화면
  - [ ] 고객 관리 화면
  - [ ] 발송 기록 화면
  - [ ] 설정 화면

---

### 10. 푸시 알림 기능 구현
**우선순위**: ⭐⭐  
**예상 소요**: 10-12시간

#### 9.1 푸시 알림 서비스 설정
- [ ] Firebase Cloud Messaging (FCM) 설정
  - [ ] Firebase 프로젝트 생성
  - [ ] Android 앱 등록
  - [ ] `google-services.json` 추가
  - [ ] FCM 토큰 등록
- [ ] 또는 Expo Push Notifications (Expo 사용 시)
- [ ] 토큰 관리
  - [ ] 토큰 생성 및 저장
  - [ ] 토큰 갱신 처리
  - [ ] Supabase에 토큰 저장

#### 9.2 알림 트리거 로직
- [ ] 생일/기념일 알림
  - [ ] D-Day 계산 (D-0, D-1, D-3, D-7)
  - [ ] 설정된 시간에 알림 발송
  - [ ] Supabase Function 또는 앱 내 로컬 알림
- [ ] 작업 완료 알림
  - [ ] 발송 완료 시 알림
  - [ ] 일일 발송 완료 알림
- [ ] 한도 초과 알림
  - [ ] 한도 80% 도달 시 경고
  - [ ] 한도 초과 시 알림

#### 9.3 알림 처리
- [ ] 알림 수신 처리
  - [ ] 포그라운드 알림
  - [ ] 백그라운드 알림
  - [ ] 알림 클릭 시 앱 열기
- [ ] 딥링크 처리
  - [ ] 알림 클릭 시 특정 화면으로 이동
  - [ ] 고객 상세 페이지로 이동
  - [ ] 문자 보내기 화면으로 이동
- [ ] 알림 설정
  - [ ] 알림 활성화/비활성화
  - [ ] 알림 시간 설정
  - [ ] 알림 타입별 설정

---

## 🎯 Phase 3: 고급 기능 및 최적화 - Week 3-4

### 11. 백그라운드 작업 처리
**우선순위**: ⭐  
**예상 소요**: 8-10시간

- [ ] 백그라운드 서비스 구현
  - [ ] `react-native-background-actions` 활용
  - [ ] 큐 처리 백그라운드 실행
  - [ ] 배터리 최적화
- [ ] 포그라운드 서비스 (선택)
  - [ ] 발송 중 알림 표시
  - [ ] 진행률 표시
- [ ] 앱 종료 시 처리
  - [ ] 큐 상태 저장
  - [ ] 재시작 시 복구

---

### 12. 오프라인 지원
**우선순위**: ⭐  
**예상 소요**: 6-8시간

- [ ] 오프라인 큐 저장
  - [ ] AsyncStorage에 큐 저장
  - [ ] 오프라인 상태 감지
- [ ] 온라인 복구
  - [ ] 네트워크 연결 시 자동 동기화
  - [ ] 누락된 작업 확인 및 처리
- [ ] 오프라인 UI
  - [ ] 오프라인 상태 표시
  - [ ] 대기 중인 작업 표시

---

### 13. 성능 최적화
**우선순위**: ⭐  
**예상 소요**: 6-8시간

- [ ] 메모리 최적화
  - [ ] 이미지 캐싱
  - [ ] 불필요한 리렌더링 방지
  - [ ] 메모리 누수 방지
- [ ] 배터리 최적화
  - [ ] 백그라운드 작업 최소화
  - [ ] 폴링 간격 조정
  - [ ] 효율적인 타이머 사용
- [ ] 네트워크 최적화
  - [ ] 요청 배칭
  - [ ] 캐싱 전략
  - [ ] 데이터 압축

---

### 14. 에러 처리 및 로깅
**우선순위**: ⭐  
**예상 소요**: 4-6시간

- [ ] 전역 에러 핸들러
  - [ ] 크래시 리포트
  - [ ] 에러 로깅
- [ ] 로깅 시스템
  - [ ] 개발/프로덕션 로그 분리
  - [ ] Supabase에 로그 전송 (선택)
- [ ] 사용자 피드백
  - [ ] 에러 메시지 표시
  - [ ] 재시도 옵션 제공

---

### 15. 테스트 및 디버깅
**우선순위**: ⭐⭐⭐  
**예상 소요**: 8-10시간 (전 기간 동안)

- [ ] 단위 테스트
  - [ ] 큐 관리 로직 테스트
  - [ ] 한도 체크 테스트
  - [ ] 템플릿 파서 테스트
- [ ] 통합 테스트
  - [ ] 웹-앱 연동 테스트
  - [ ] Supabase 연동 테스트
- [ ] 실제 디바이스 테스트
  - [ ] 다양한 안드로이드 버전 테스트
  - [ ] 다양한 통신사 테스트
  - [ ] 배터리 소모 테스트
  - [ ] 백그라운드 동작 테스트
- [ ] 성능 테스트
  - [ ] 대량 작업 처리 테스트
  - [ ] 메모리 사용량 모니터링
  - [ ] 배터리 사용량 모니터링

---

## 🎯 Phase 4: 배포 준비 - Week 4

### 16. UI/UX 개선
**우선순위**: ⭐  
**예상 소요**: 6-8시간

- [ ] 디자인 시스템 구축
  - [ ] 색상 팔레트
  - [ ] 타이포그래피
  - [ ] 컴포넌트 라이브러리
- [ ] 다크 모드 지원 (선택)
- [ ] 접근성 개선
  - [ ] 스크린 리더 지원
  - [ ] 터치 영역 최적화
- [ ] 애니메이션 추가
  - [ ] 부드러운 전환
  - [ ] 로딩 애니메이션

---

### 17. 보안 강화
**우선순위**: ⭐⭐  
**예상 소요**: 4-6시간

- [ ] 코드 난독화
- [ ] API 키 보안
  - [ ] 환경 변수 관리
  - [ ] 키 숨김 처리
- [ ] 권한 최소화
  - [ ] 필요한 권한만 요청
  - [ ] 권한 설명 명확화

---

### 18. 문서화
**우선순위**: ⭐  
**예상 소요**: 4-6시간

- [ ] 사용자 가이드
- [ ] 개발자 문서
- [ ] API 문서
- [ ] 트러블슈팅 가이드

---

### 19. 배포 준비
**우선순위**: ⭐⭐  
**예상 소요**: 6-8시간

- [ ] 앱 서명 설정
- [ ] Google Play Console 설정
- [ ] 앱 아이콘 및 스플래시 화면
- [ ] 스토어 설명 및 스크린샷
- [ ] 베타 테스트
- [ ] 프로덕션 빌드

---

## 📊 진행 상황 추적

### 전체 진행률
- [ ] Phase 1: 핵심 기능 (0/6 완료)
- [ ] Phase 2: 스마트 기능 (0/4 완료)
- [ ] Phase 3: 고급 기능 (0/4 완료)
- [ ] Phase 4: 배포 준비 (0/4 완료)

### 우선순위별 진행률
- [ ] ⭐⭐⭐ 최상위 우선순위 (0/6 완료)
- [ ] ⭐⭐ 높은 우선순위 (0/4 완료)
- [ ] ⭐ 일반 우선순위 (0/9 완료)

---

## 📝 참고 사항

### 기술 스택
- **프레임워크**: React Native 0.73.0
- **언어**: TypeScript
- **백엔드**: Supabase (PostgreSQL, Auth, Storage, Realtime)
- **SMS 발송**: react-native-get-sms-android
- **통화 감지**: react-native-call-detection
- **주소록 읽기**: react-native-contacts
- **로컬 저장**: AsyncStorage
- **푸시 알림**: Firebase Cloud Messaging (FCM)

### 중요 사항
1. **스로틀링은 필수**: 통신사 제재를 피하기 위해 반드시 구현
2. **일일 한도 준수**: 199건(안전) 또는 490건(최대) 초과 금지
3. **실제 디바이스 테스트**: 에뮬레이터에서는 SMS 발송 불가
4. **백그라운드 처리**: 앱이 꺼져 있어도 발송 가능해야 함
5. **에러 처리**: 모든 실패 케이스에 대한 처리 필요

### 예상 총 소요 시간
- **Phase 1**: 42-50시간 (약 1.5-2주)
- **Phase 2**: 36-44시간 (약 1주) - 주소록 업로드 기능 추가
- **Phase 3**: 24-30시간 (약 1주)
- **Phase 4**: 20-28시간 (약 1주)
- **총계**: 122-152시간 (약 3-4주, 주 40시간 기준)

---

**마지막 업데이트**: 2025년 1월 27일  
**다음 리뷰**: Phase 1 완료 후

