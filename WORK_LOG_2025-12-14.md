# BizConnect ì‘ì—… ì¼ì§€ - 2025-12-14

## ì‘ì—… ê°œìš”
êµ¬ê¸€ ë¡œê·¸ì¸ë¶€í„° ì‹œì‘í•˜ì—¬ ëŒ€ì‹œë³´ë“œ UI/UX ê°œì„ , AI ë©”ì‹œì§€ ìƒì„± ê¸°ëŠ¥, ì›¹-ì•± ë¬¸ì ë™ê¸°í™” ë“± ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ê°œë°œí–ˆìœ¼ë‚˜, í•µì‹¬ ê¸°ëŠ¥ë“¤ì´ ì—¬ì „íˆ ì‘ë™í•˜ì§€ ì•ŠëŠ” ìƒíƒœì…ë‹ˆë‹¤.

---

## ì™„ë£Œëœ ì‘ì—… (2025-12-14)

### 1. êµ¬ê¸€ OAuth ë¡œê·¸ì¸ ìˆ˜ì •
- **íŒŒì¼**: `web/src/app/auth/callback/page.tsx`, `web/src/app/page.tsx`
- **ë‚´ìš©**: 
  - `useSearchParams()` Suspense ê²½ê³„ ì¶”ê°€
  - OAuth ì½œë°± ì²˜ë¦¬ ë¡œì§ ê°œì„ 
  - Supabase ë° Google Cloud Console ì„¤ì • ê°€ì´ë“œ ì‘ì„±
- **ìƒíƒœ**: âœ… ì™„ë£Œ (ë¡œê·¸ì¸ì€ ì„±ê³µ)

### 2. ëŒ€ì‹œë³´ë“œ UI/UX ê°œì„ 
- **íŒŒì¼**: `web/src/app/dashboard/page.tsx`, `web/src/app/dashboard/layout.tsx`
- **ë‚´ìš©**:
  - ëŒ€ì‹œë³´ë“œ ë””ìì¸ í˜„ëŒ€í™”
  - ì¢Œì¸¡ ì‚¬ì´ë“œë°” ë©”ë‰´ ì¶”ê°€
  - ì„¤ì • ë²„íŠ¼ì„ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì˜†ìœ¼ë¡œ ì´ë™
  - ê°œì¸í™” ë°°ë„ˆ ì¶”ê°€
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 3. AI ë©”ì‹œì§€ ìƒì„± ê¸°ëŠ¥ ê°œì„ 
- **íŒŒì¼**: `web/src/app/api/ai/suggest-message/route.ts`, `web/src/components/AIMessageSuggestions.tsx`
- **ë‚´ìš©**:
  - í•œêµ­ ì‹œê°„ëŒ€ ì¸ì‹ ì¶”ê°€
  - ì‚¬ìš©ì ì´ë¦„ ê°•ì œ ì‚¬ìš© ë¡œì§
  - AI ì˜ë„ ìƒ˜í”Œ í¸ì§‘ ê¸°ëŠ¥ ì¶”ê°€
  - ê³ ê° ì •ë³´ ê¸°ë°˜ í†¤ ì¡°ì ˆ
- **ìƒíƒœ**: âœ… ë¶€ë¶„ ì™„ë£Œ (ì´ë¦„ ì¸ì‹ ë¬¸ì œ ì—¬ì „íˆ ì¡´ì¬)

### 4. ê³ ê° ê´€ë¦¬ ê¸°ëŠ¥ ê°œì„ 
- **íŒŒì¼**: `web/src/app/dashboard/customers/page.tsx`
- **ë‚´ìš©**: ë¹ ë¥¸ ì¹´í…Œê³ ë¦¬ í• ë‹¹ ê¸°ëŠ¥ ì¶”ê°€
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 5. Open Graph ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° êµ¬í˜„
- **íŒŒì¼**: `web/src/app/api/preview/[imageId]/route.ts`
- **ë‚´ìš©**: 
  - Open Graph ë©”íƒ€ íƒœê·¸ ì¶”ê°€
  - ì´ë¯¸ì§€ í¬ê¸° 1920x1080ìœ¼ë¡œ ì¦ê°€
  - CSSë¡œ ì´ë¯¸ì§€ í•˜ë‹¨ í…ìŠ¤íŠ¸ ìˆ¨ê¹€ ì‹œë„
- **ìƒíƒœ**: âš ï¸ ë¶€ë¶„ ì™„ë£Œ (ì—¬ì „íˆ "ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°" í…ìŠ¤íŠ¸ í‘œì‹œë¨)

### 6. ì•± ë¬¸ì ë°œì†¡ ê¸°ëŠ¥ ìˆ˜ì •
- **íŒŒì¼**: `mobile/src/services/taskService.ts`, `mobile/src/lib/smsSender.ts`
- **ë‚´ìš©**:
  - ì›¹â†’ì•± ë¬¸ì ë™ê¸°í™” ë¡œì§ ê°œì„  ì‹œë„
  - í´ë§ ê°„ê²© 1ì´ˆë¡œ ë‹¨ì¶•
  - RECENT_MINUTES 30ë¶„ìœ¼ë¡œ ì¦ê°€
  - ì¿¼ë¦¬ ì¡°ê±´ ë‹¨ìˆœí™”
- **ìƒíƒœ**: âŒ ì‹¤íŒ¨ (ì—¬ì „íˆ ì‘ë™ ì•ˆí•¨)

### 7. ì•± UI ìˆ˜ì •
- **íŒŒì¼**: `mobile/src/screens/SendSMSScreen.tsx`
- **ë‚´ìš©**:
  - ë©”ì¸ í™”ë©´ ë’¤ë¡œ ê°€ê¸° ë²„íŠ¼ ì œê±°
  - ëª…í•¨ ì‚¬ìš© ë²„íŠ¼ ì¶”ê°€ ì‹œë„
- **ìƒíƒœ**: âš ï¸ ë¶€ë¶„ ì™„ë£Œ (ëª…í•¨ ë²„íŠ¼ì€ ì¶”ê°€í–ˆìœ¼ë‚˜ ì‘ë™ ì•ˆí•¨)

### 8. ëª…í•¨ ì´ë¯¸ì§€ ì—…ë¡œë“œ ìˆ˜ì •
- **íŒŒì¼**: `mobile/src/screens/CallbackSettingsScreen.tsx`
- **ë‚´ìš©**: ì›¹ API ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½ ì‹œë„
- **ìƒíƒœ**: âŒ ì‹¤íŒ¨ (ì—¬ì „íˆ ì—ëŸ¬ ë°œìƒ)

---

## í•´ê²°ë˜ì§€ ì•Šì€ ë¬¸ì œì  (Critical)

### 1. ì›¹ì—ì„œ ë¬¸ì ë³´ë‚´ë©´ ì•±ì—ì„œ ì „í˜€ ì‘ë™ ì•ˆí•¨ âš ï¸âš ï¸âš ï¸
- **ì¦ìƒ**: ì›¹ì—ì„œ ë¬¸ì ë°œì†¡ ì‹œ ì•±ì´ ì „í˜€ ê°ì§€í•˜ì§€ ëª»í•¨
- **ì‹œë„í•œ í•´ê²°ì±…**:
  - ì‹¤ì‹œê°„ êµ¬ë… ë¡œì§ ê°œì„ 
  - í´ë§ ê°„ê²© 1ì´ˆë¡œ ë‹¨ì¶•
  - RECENT_MINUTES 30ë¶„ìœ¼ë¡œ ì¦ê°€
  - ì¿¼ë¦¬ ì¡°ê±´ ë‹¨ìˆœí™”
  - ë””ë²„ê¹… ë¡œê·¸ ëŒ€ëŸ‰ ì¶”ê°€
- **ê²°ê³¼**: ì „í˜€ ê°œì„ ë˜ì§€ ì•ŠìŒ
- **ê´€ë ¨ íŒŒì¼**: `mobile/src/services/taskService.ts`
- **ìš°ì„ ìˆœìœ„**: ìµœìš°ì„ 

### 2. ì•±ì—ì„œ ëª…í•¨ ì²¨ë¶€ ë²„íŠ¼ ì‘ë™ ì•ˆí•¨
- **ì¦ìƒ**: ì´ë¯¸ì§€ ì„ íƒ ëª¨ë‹¬ì— "ëª…í•¨ ì‚¬ìš©" ë²„íŠ¼ì€ ë³´ì´ì§€ë§Œ í´ë¦­í•´ë„ ì‘ë™ ì•ˆí•¨
- **ì½”ë“œ ìƒíƒœ**: `handleSelectBusinessCard` í•¨ìˆ˜ëŠ” ì¶”ê°€ë¨
- **ë¬¸ì œì **: 
  - `businessCardImageUrl`ì´ ì œëŒ€ë¡œ ë¡œë“œë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
  - `loadBusinessCard` í•¨ìˆ˜ê°€ ì œëŒ€ë¡œ í˜¸ì¶œë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
  - Open Graph URL ìƒì„± ë¡œì§ì— ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìŒ
- **ê´€ë ¨ íŒŒì¼**: `mobile/src/screens/SendSMSScreen.tsx`
- **ìš°ì„ ìˆœìœ„**: ë†’ìŒ

### 3. ëª…í•¨ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì—ëŸ¬
- **ì¦ìƒ**: ì½œë°± ì„¤ì • í™”ë©´ì—ì„œ ëª…í•¨ ì´ë¯¸ì§€ ë³€ê²½ ì‹œ ì—ëŸ¬ ë°œìƒ
- **ì‹œë„í•œ í•´ê²°ì±…**:
  - ì›¹ API `/api/upload-image` ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½
  - FormData ì‚¬ìš©
- **ê²°ê³¼**: ì—¬ì „íˆ ì—ëŸ¬ ë°œìƒ
- **ê´€ë ¨ íŒŒì¼**: `mobile/src/screens/CallbackSettingsScreen.tsx`
- **ìš°ì„ ìˆœìœ„**: ë†’ìŒ

### 4. ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°ì— "ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°" í…ìŠ¤íŠ¸ í‘œì‹œ
- **ì¦ìƒ**: Open Graph ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ì´ë¯¸ì§€ í•˜ë‹¨ì— "ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°" í…ìŠ¤íŠ¸ê°€ í‘œì‹œë˜ì–´ ì´ë¯¸ì§€ë¥¼ ê°€ë¦¼
- **ì‹œë„í•œ í•´ê²°ì±…**:
  - CSSë¡œ `::after` ìˆ¨ê¹€ ì²˜ë¦¬
  - `og:title`ì„ "ğŸ“‡ ë‚´ ëª…í•¨" ë˜ëŠ” ë¹ˆ ê°’ìœ¼ë¡œ ë³€ê²½ ì‹œë„
- **ê²°ê³¼**: ì—¬ì „íˆ í…ìŠ¤íŠ¸ í‘œì‹œë¨
- **ë¬¸ì œì **: 
  - `og:title`ì´ ë©”ì‹œì§€ ì•±ì—ì„œ í‘œì‹œë˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì„
  - HTML bodyì˜ í…ìŠ¤íŠ¸ê°€ ì•„ë‹ˆë¼ Open Graph ë©”íƒ€ íƒœê·¸ì˜ titleì´ ë¬¸ì œì¼ ìˆ˜ ìˆìŒ
- **ê´€ë ¨ íŒŒì¼**: `web/src/app/api/preview/[imageId]/route.ts`
- **ìš°ì„ ìˆœìœ„**: ì¤‘ê°„

### 5. AIê°€ ì‚¬ìš©ì ì´ë¦„ì„ ì œëŒ€ë¡œ ì¸ì‹í•˜ì§€ ëª»í•¨
- **ì¦ìƒ**: AIê°€ ì´ë©”ì¼ IDë¥¼ ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©í•˜ê±°ë‚˜, ì´ë¦„ì´ ì„¤ì •ë˜ì–´ ìˆì–´ë„ "ì´ë¦„ì„ ì…ë ¥í•˜ë¼"ê³  í•¨
- **ì‹œë„í•œ í•´ê²°ì±…**:
  - `full_name` ê°•ì œ ì‚¬ìš© ë¡œì§ ì¶”ê°€
  - RLS ì •ì±… ìˆ˜ì •
  - ë””ë²„ê¹… ë¡œê·¸ ëŒ€ëŸ‰ ì¶”ê°€
- **ê²°ê³¼**: ì—¬ì „íˆ ë¬¸ì œ ë°œìƒ
- **ê´€ë ¨ íŒŒì¼**: `web/src/app/api/ai/suggest-message/route.ts`
- **ìš°ì„ ìˆœìœ„**: ì¤‘ê°„

---

## ë¹Œë“œ ê´€ë ¨

### ì‹¤ì œ ë¹Œë“œ ëª…ë ¹ì–´
```cmd
cd C:\call\mobile\android
.\gradlew clean
.\gradlew assembleRelease
```

ë˜ëŠ”

```cmd
C:\call\mobile\build-release.cmd
```

### TODOS.mdì™€ì˜ ì°¨ì´ì 
- **TODOS.md**: `build-release.cmd` ì‚¬ìš© ê¶Œì¥
- **ì‹¤ì œ**: `gradlew clean` í›„ `gradlew assembleRelease` ì§ì ‘ ì‹¤í–‰ë„ ê°€ëŠ¥
- **ì°¨ì´**: TODOS.mdëŠ” ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©ì„ ê¶Œì¥í•˜ì§€ë§Œ, ì‹¤ì œë¡œëŠ” ì§ì ‘ ëª…ë ¹ì–´ ì‹¤í–‰ë„ ë¬¸ì œì—†ìŒ

### ê¶Œì¥ ì‚¬í•­
- `build-release.cmd` ìŠ¤í¬ë¦½íŠ¸ê°€ JAVA_HOMEì„ ìë™ ì„¤ì •í•˜ë¯€ë¡œ ì‚¬ìš© ê¶Œì¥
- í•˜ì§€ë§Œ ì§ì ‘ ëª…ë ¹ì–´ ì‹¤í–‰ë„ ë¬¸ì œì—†ìŒ

---

## ì½”ë“œ ìˆ˜ì • ë‚´ì—­ ìš”ì•½

### ì›¹ (Web)
1. `web/src/app/auth/callback/page.tsx` - OAuth ì½œë°± ì²˜ë¦¬
2. `web/src/app/page.tsx` - ë£¨íŠ¸ í˜ì´ì§€ ë¦¬ë‹¤ì´ë ‰íŠ¸
3. `web/src/app/dashboard/page.tsx` - ëŒ€ì‹œë³´ë“œ UI ê°œì„ 
4. `web/src/app/dashboard/layout.tsx` - ë ˆì´ì•„ì›ƒ ì¶”ê°€
5. `web/src/app/dashboard/send/page.tsx` - ë‹¨ê±´ ë°œì†¡ ì œê±°, ë‹¤ì¤‘ ì´ë¯¸ì§€ ì§€ì›
6. `web/src/app/dashboard/settings/page.tsx` - AI ì˜ë„ ìƒ˜í”Œ í¸ì§‘, ì „í™”ë²ˆí˜¸ í•„ë“œ ì¶”ê°€
7. `web/src/app/dashboard/customers/page.tsx` - ë¹ ë¥¸ ì¹´í…Œê³ ë¦¬ í• ë‹¹
8. `web/src/app/api/ai/suggest-message/route.ts` - AI ë¡œì§ ê°œì„ 
9. `web/src/app/api/preview/[imageId]/route.ts` - Open Graph êµ¬í˜„

### ì•± (Mobile)
1. `mobile/src/services/taskService.ts` - ì›¹â†’ì•± ë™ê¸°í™” ë¡œì§ ê°œì„  (ì‹¤íŒ¨)
2. `mobile/src/lib/smsSender.ts` - ë©”ì‹œì§€-URL ì¤„ë°”ê¿ˆ ì¡°ì •
3. `mobile/src/screens/SendSMSScreen.tsx` - ë’¤ë¡œ ê°€ê¸° ë²„íŠ¼ ì œê±°, ëª…í•¨ ë²„íŠ¼ ì¶”ê°€ (ì‘ë™ ì•ˆí•¨)
4. `mobile/src/screens/CallbackSettingsScreen.tsx` - ëª…í•¨ ì—…ë¡œë“œ ë¡œì§ ë³€ê²½ (ì—ëŸ¬ ë°œìƒ)
5. `mobile/src/lib/callbackManager.ts` - ì½œë°± ë¡œì§ ê°œì„ 

### ë°ì´í„°ë² ì´ìŠ¤
1. `supabase/add-ai-intent-samples.sql` - AI ì˜ë„ ìƒ˜í”Œ ì»¬ëŸ¼ ì¶”ê°€
2. `supabase/add-phone-to-user-settings.sql` - ì „í™”ë²ˆí˜¸ í•„ë“œ ì¶”ê°€

---

## ë‹¤ìŒ ì‘ì—… ìš°ì„ ìˆœìœ„

### ìµœìš°ì„  (Critical)
1. **ì›¹â†’ì•± ë¬¸ì ë™ê¸°í™” ì™„ì „ ìˆ˜ì •**
   - ì‹¤ì‹œê°„ êµ¬ë…ì´ ì‘ë™í•˜ì§€ ì•ŠëŠ” ê·¼ë³¸ ì›ì¸ íŒŒì•… í•„ìš”
   - Supabase Realtime ì„¤ì • í™•ì¸ í•„ìš”
   - RLS ì •ì±… ì¬í™•ì¸ í•„ìš”

### ë†’ìŒ (High)
2. **ëª…í•¨ ì²¨ë¶€ ë²„íŠ¼ ì‘ë™ í™•ì¸**
   - `loadBusinessCard` í•¨ìˆ˜ í˜¸ì¶œ í™•ì¸
   - `businessCardImageUrl` ìƒíƒœ í™•ì¸
   - `handleSelectBusinessCard` í•¨ìˆ˜ ë””ë²„ê¹…

3. **ëª…í•¨ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì—ëŸ¬ í•´ê²°**
   - ì›¹ API í˜¸ì¶œ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
   - FormData ìƒì„± ë¡œì§ í™•ì¸
   - React Native FormData í˜¸í™˜ì„± í™•ì¸

### ì¤‘ê°„ (Medium)
4. **ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° í…ìŠ¤íŠ¸ ì œê±°**
   - `og:title`ì„ ë¹ˆ ê°’ ë˜ëŠ” ìµœì†Œí•œì˜ í…ìŠ¤íŠ¸ë¡œ ë³€ê²½
   - ë©”ì‹œì§€ ì•±ë³„ Open Graph íŒŒì‹± ë™ì‘ í™•ì¸

5. **AI ì´ë¦„ ì¸ì‹ ë¬¸ì œ í•´ê²°**
   - RLS ì •ì±… ì¬í™•ì¸
   - `user_settings` ì¡°íšŒ ë¡œì§ ì¬í™•ì¸

---

## ì°¸ê³ ì‚¬í•­

- ëª¨ë“  ìˆ˜ì • ì‚¬í•­ì€ GitHubì— í‘¸ì‹œë¨
- ë¹Œë“œëŠ” ì„±ê³µí–ˆìœ¼ë‚˜ ê¸°ëŠ¥ì€ ì‘ë™í•˜ì§€ ì•ŠìŒ
- ë””ë²„ê¹… ë¡œê·¸ëŠ” ëŒ€ëŸ‰ìœ¼ë¡œ ì¶”ê°€ë˜ì–´ ìˆìœ¼ë‚˜ ê·¼ë³¸ ì›ì¸ íŒŒì•… ì‹¤íŒ¨
- ì‚¬ìš©ì í”¼ë“œë°±: "ì•„ë¬´ê²ƒë„ í•´ê²°ëœ ê²Œ ì—†ë‹¤"

---

## FCM í‘¸ì‹œ êµ¬í˜„ ì‘ì—… (ì˜¤í›„)

### ë°°ê²½
- ê¸°ì¡´ Realtime + í´ë§ ë°©ì‹ â†’ ë°°í„°ë¦¬ ì†Œëª¨ ì‹¬í•¨, ë¶ˆì•ˆì •
- FCM í‘¸ì‹œ ê¸°ë°˜ìœ¼ë¡œ ë³€ê²½ ì‹œë„

### ì™„ë£Œëœ ì‘ì—…

#### 1. FCM HTTP v1 API ë§ˆì´ê·¸ë ˆì´ì…˜
- **ë¬¸ì œ**: Legacy FCM APIê°€ 2024ë…„ 7ì›” ì™„ì „ ì¤‘ë‹¨ë¨
- **í•´ê²°**: FCM HTTP v1 API + OAuth2 ì¸ì¦ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
- **íŒŒì¼**: `web/src/app/api/send-fcm/route.ts`
  - JWT ìƒì„± ë° OAuth2 ì•¡ì„¸ìŠ¤ í† í° íšë“
  - Firebase ì„œë¹„ìŠ¤ ê³„ì • ì¸ì¦ ì‚¬ìš©
  - Private Key í¬ë§· ì²˜ë¦¬ í•¨ìˆ˜ ì¶”ê°€ (Vercel í™˜ê²½ë³€ìˆ˜ `\n` ì´ìŠˆ í•´ê²°)

#### 2. ì•± FCM ì„¤ì •
- `mobile/index.js`: ë°±ê·¸ë¼ìš´ë“œ ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ ë“±ë¡
- `mobile/src/services/fcmService.ts`: ì¤‘ë³µ í•¸ë“¤ëŸ¬ ì œê±°
- `mobile/src/components/CallDetectionProvider.tsx`: Activity ì¤€ë¹„ ëŒ€ê¸° (1ì´ˆ ë”œë ˆì´)

#### 3. GitHub í‘¸ì‹œ
- ì»¤ë°‹: `feat: FCM ë°±ê·¸ë¼ìš´ë“œ ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ ìˆ˜ì •`

#### 4. ë³´ì•ˆ
- `.gitignore`ì— Firebase Admin SDK í‚¤ íŒ¨í„´ ì¶”ê°€

### í˜„ì¬ ìƒíƒœ

| ë‹¨ê³„ | ìƒíƒœ | ì„¤ëª… |
|------|------|------|
| ì›¹ â†’ FCM ì„œë²„ | âœ… ì„±ê³µ | `{success: true, message: 'FCM push sent'}` |
| FCM ì„œë²„ â†’ ì•± | âœ… ìˆ˜ì‹ ë¨ | ë¡œê·¸ì—ì„œ í™•ì¸ë¨ |
| ì•±ì—ì„œ SMS ë°œì†¡ | âŒ ì‹¤íŒ¨ | í¬ë˜ì‹œë¡œ ì¸í•´ ì²˜ë¦¬ ì•ˆë¨ |

### FCM ìˆ˜ì‹  ë¡œê·¸ (í™•ì¸ë¨)
```
[FCM] Background message received:
{
  "data": {
    "type": "send_sms",
    "taskId": "87204e2c-f18c-4545-a371-27fce98823f7"
  },
  "notification": {
    "title": "ë¬¸ì ë°œì†¡ ìš”ì²­",
    "body": "ì›¹ì—ì„œ ë¬¸ì ë°œì†¡ ìš”ì²­ì´ ìˆìŠµë‹ˆë‹¤."
  }
}
```

### ì›ì¸ ë¶„ì„

#### 1. ì•± í¬ë˜ì‹œ ë¬¸ì œ (ì£¼ìš” ì›ì¸)
```
java.lang.NullPointerException:
  Attempt to invoke virtual method 'android.app.Application
  android.app.Activity.getApplication()' on a null object reference
at com.pritesh.calldetection.CallDetectionManagerModule.startListener
```
- **ì›ì¸**: CallDetection ëª¨ë“ˆì´ Activity ì¤€ë¹„ ì „ì— ì‹¤í–‰
- **ìˆ˜ì •**: 1ì´ˆ ë”œë ˆì´ ì¶”ê°€ (ì•„ì§ ë¹Œë“œ/í…ŒìŠ¤íŠ¸ ì•ˆë¨)

#### 2. ë°±ê·¸ë¼ìš´ë“œ SMS ë°œì†¡ ì œí•œ
- Androidì—ì„œ ë°±ê·¸ë¼ìš´ë“œ ìƒíƒœì—ì„œëŠ” SMS ë°œì†¡ì— ì œí•œ
- FCM ë©”ì‹œì§€ëŠ” ìˆ˜ì‹ ë˜ì§€ë§Œ, ë°±ê·¸ë¼ìš´ë“œì—ì„œ SMS ë°œì†¡ ê¶Œí•œ/ì»¨í…ìŠ¤íŠ¸ ë¶€ì¡± ê°€ëŠ¥

#### 3. í¬ê·¸ë¼ìš´ë“œ í•¸ë“¤ëŸ¬ ë¯¸í™œì„±í™”
- ì•± í¬ë˜ì‹œë¡œ ì¸í•´ fcmService.onMessage (í¬ê·¸ë¼ìš´ë“œ í•¸ë“¤ëŸ¬)ê°€ í™œì„±í™” ì•ˆë¨
- í¬ë˜ì‹œ í•´ê²° í›„ í¬ê·¸ë¼ìš´ë“œì—ì„œ í…ŒìŠ¤íŠ¸ í•„ìš”

### í™˜ê²½ë³€ìˆ˜ (Vercel)
```
FIREBASE_PROJECT_ID=call-93289
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-fbsvc@call-93289.iam.gserviceaccount.com
FIREBASE_PRIVATE_KEY=(ì„œë¹„ìŠ¤ ê³„ì • í‚¤)
```

### ë‹¤ìŒ ì‘ì—… í•„ìš”ì‚¬í•­
1. **CallDetection í¬ë˜ì‹œ ìˆ˜ì •** - ë”œë ˆì´ ì¶”ê°€ í›„ ë¹Œë“œ/í…ŒìŠ¤íŠ¸
2. **í¬ê·¸ë¼ìš´ë“œ í…ŒìŠ¤íŠ¸** - ì•±ì´ ì—´ë¦° ìƒíƒœì—ì„œ FCM ìˆ˜ì‹  ë° SMS ë°œì†¡ í…ŒìŠ¤íŠ¸
3. **FCM í† í° í™•ì¸** - Supabase DBì™€ ì•± í† í° ì¼ì¹˜ ì—¬ë¶€ í™•ì¸
4. **ë°±ê·¸ë¼ìš´ë“œ SMS ë°œì†¡** - HeadlessJS ë˜ëŠ” ë‹¤ë¥¸ ë°©ë²• ê²€í† 

---

**ì‘ì„±ì¼**: 2025-12-14
**ìƒíƒœ**: FCM ìˆ˜ì‹ ê¹Œì§€ëŠ” ì„±ê³µ, SMS ë°œì†¡ì€ ì•± í¬ë˜ì‹œë¡œ ì‹¤íŒ¨
**ë‹¤ìŒ ì‘ì—…**: CallDetection í¬ë˜ì‹œ í•´ê²° í›„ ì¬í…ŒìŠ¤íŠ¸

---

## SMS ìŠ¹ì¸ ì‹œìŠ¤í…œ ìµœì í™” í”Œëœ (ì €ë…)

### í˜„ì¬ ë¬¸ì œì  (í…ŒìŠ¤íŠ¸ ê²°ê³¼)

| ë¬¸ì œ | ì¦ìƒ | ì›ì¸ ì¶”ì • |
|------|------|----------|
| ë‘ ë²ˆì§¸ ë¬¸ìë¶€í„° ìŠ¹ì¸ í‘¸ì‹œ ì•ˆ ì˜´ | ì²« ë²ˆì§¸ëŠ” OK, ë‘ ë²ˆì§¸ë¶€í„° "ë¬¸ì ì™”ìŠµë‹ˆë‹¤" í‘¸ì‹œë§Œ ì˜´ | FCM vs í´ë§ ì¶©ëŒ |
| ëª…í•¨ URL 2ê°œ ì „ì†¡ | í•˜ë‚˜ë§Œ ì„ íƒí•´ë„ 2ê°œ URLì´ ë©”ì‹œì§€ì— í¬í•¨ë¨ | ì›¹ì—ì„œ ì¤‘ë³µ ì„¤ì • or ì•±ì—ì„œ ì¤‘ë³µ ì¶”ê°€ |
| ëª…í•¨ ì„ íƒ ì•ˆ í•´ë„ URL ì „ì†¡ | ì²´í¬ ì•ˆ í–ˆëŠ”ë° ëª…í•¨ URLì´ ê°™ì´ ê° | ì›¹ì—ì„œ ê¸°ë³¸ê°’ìœ¼ë¡œ ëª…í•¨ URL ì„¤ì • |

### ì´ìƒì ì¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ì´ìƒì ì¸ íë¦„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  [ì›¹ ë°œì†¡ í´ë¦­]                                                      â”‚
â”‚       â†“                                                             â”‚
â”‚  [tasks í…Œì´ë¸” INSERT]  â† image_url: ì²´í¬ë°•ìŠ¤ ì„ íƒ ì‹œì—ë§Œ            â”‚
â”‚       â†“                                                             â”‚
â”‚  [FCM í‘¸ì‹œ ë°œì†¡] â† task_id í¬í•¨                                      â”‚
â”‚       â†“                                                             â”‚
â”‚  [ì•±: FCM ìˆ˜ì‹ ] â†’ notifiedTaskIdsì— ì¦‰ì‹œ ë“±ë¡ (ì¤‘ë³µ ë°©ì§€)            â”‚
â”‚       â†“                                                             â”‚
â”‚  [ìŠ¹ì¸ ì•Œë¦¼ í‘œì‹œ] â† 1ê±´ë§Œ!                                           â”‚
â”‚       â†“                                                             â”‚
â”‚  [ì‚¬ìš©ì ìŠ¹ì¸]                                                       â”‚
â”‚       â†“                                                             â”‚
â”‚  [SMS ë°œì†¡] â† image_url ìˆìœ¼ë©´ 1ê°œë§Œ ì¶”ê°€                            â”‚
â”‚       â†“                                                             â”‚
â”‚  [task ìƒíƒœ completed]                                              â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•µì‹¬ ì›ì¹™

1. **FCM = ìœ ì¼í•œ íŠ¸ë¦¬ê±°** - í´ë§ì€ FCM ì‹¤íŒ¨ ì‹œ ë°±ì—…ìš©
2. **í•œ ë²ˆë§Œ ì²˜ë¦¬** - task_idë¡œ ì² ì €íˆ ì¤‘ë³µ ì²´í¬
3. **ëª…ì‹œì  ì´ë¯¸ì§€** - ì‚¬ìš©ìê°€ ì„ íƒí•œ ê²½ìš°ë§Œ
4. **ë‹¨ìˆœí•œ ì½”ë“œ** - ë³µì¡í•œ ì¡°ê±´ë¬¸ ìµœì†Œí™”

---

### ìˆ˜ì • ê³„íš

#### Phase 1: ì›¹ ìˆ˜ì • (image_url ë¬¸ì œ í•´ê²°)

**íŒŒì¼**: `web/src/app/dashboard/send/page.tsx`

```javascript
// Before (ë¬¸ì œ)
image_url: businessCardUrl || selectedImage || null  // ê¸°ë³¸ ëª…í•¨ì´ ë“¤ì–´ê°

// After (ìˆ˜ì •)
image_url: attachBusinessCard ? businessCardUrl : (selectedImage || null)  // ì²´í¬ ì‹œì—ë§Œ
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] ëª…í•¨ ì²¨ë¶€ ì²´í¬ë°•ìŠ¤ í™•ì¸
- [ ] ì²´í¬ë°•ìŠ¤ OFFë©´ image_url = null
- [ ] ì²´í¬ë°•ìŠ¤ ONì´ë©´ image_url = ëª…í•¨ URL
- [ ] ì´ë¯¸ì§€ ì§ì ‘ ì„ íƒí•˜ë©´ í•´ë‹¹ ì´ë¯¸ì§€ URL

#### Phase 2: FCM ì¤‘ë³µ ë°©ì§€ ê°•í™”

**íŒŒì¼**: `mobile/src/services/fcmService.ts`

```javascript
// FCM ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ ì¦‰ì‹œ taskServiceì— ì „ë‹¬
onMessage: async (message) => {
  const taskId = message.data?.taskId;
  if (taskId) {
    taskService.markAsNotified(taskId);  // ì¦‰ì‹œ ë“±ë¡
    taskService.showApprovalForTask(taskId);  // ì•Œë¦¼ í‘œì‹œ
  }
}
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] FCM ìˆ˜ì‹  â†’ ì¦‰ì‹œ notifiedTaskIdsì— ì¶”ê°€
- [ ] í´ë§ì—ì„œ notifiedTaskIds ì²´í¬ ê°•í™”
- [ ] í´ë§ ê°„ê²© 30ì´ˆë¡œ ì¦ê°€

#### Phase 3: smsSender ì •ë¦¬

**íŒŒì¼**: `mobile/src/lib/smsSender.ts`

```javascript
// Before (ë¬¸ì œ)
if (task.image_url) {
  finalMessage = `${message}\n\n${task.image_url}`;  // í•­ìƒ ì¶”ê°€
}

// After (ìˆ˜ì •)
if (task.image_url && !message.includes(task.image_url)) {
  finalMessage = `${message}\n\n${task.image_url}`;  // ì¤‘ë³µ ì²´í¬
}
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] image_url ì¤‘ë³µ ì¶”ê°€ ë°©ì§€
- [ ] ìµœì¢… ë©”ì‹œì§€ ë¡œê·¸ ì¶œë ¥
- [ ] URL ê°œìˆ˜ í™•ì¸

#### Phase 4: í´ë§ ìµœì í™”

**íŒŒì¼**: `mobile/src/services/taskService.ts`

- [ ] í´ë§ ê°„ê²©: 5ì´ˆ â†’ 30ì´ˆ
- [ ] FCM ì„±ê³µ ì‹œ í´ë§ ì¼ì‹œ ì¤‘ì§€
- [ ] ì•± ì¬ì‹œì‘ ì‹œì—ë§Œ í´ë§ í™œì„±í™”

---

### ìˆ˜ì • ìˆœì„œ

```
1. ì›¹ ìˆ˜ì • (image_url ë¡œì§) â†’ Vercel ë°°í¬
2. ì•± FCM ì„œë¹„ìŠ¤ ì •ë¦¬
3. ì•± taskService ì •ë¦¬
4. ì•± smsSender ì •ë¦¬
5. ë¹Œë“œ & ì„¤ì¹˜
6. í…ŒìŠ¤íŠ¸
```

### í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

| # | í…ŒìŠ¤íŠ¸ | ì˜ˆìƒ ê²°ê³¼ |
|---|--------|----------|
| 1 | ì›¹ì—ì„œ ë¬¸ìë§Œ ë°œì†¡ | ì´ë¯¸ì§€ URL ì—†ì´ ì „ì†¡ |
| 2 | ì›¹ì—ì„œ ë¬¸ì + ëª…í•¨ ì²´í¬ | ì´ë¯¸ì§€ URL 1ê°œ í¬í•¨ |
| 3 | ì—°ì† 2ê±´ ë°œì†¡ | ê°ê° 1ê°œì”© ìŠ¹ì¸ ì•Œë¦¼ |
| 4 | ì•±ì—ì„œ ì§ì ‘ ë°œì†¡ | ì •ìƒ ì‘ë™ |
| 5 | ì•±ì—ì„œ ëª…í•¨ ì²¨ë¶€ | URL 1ê°œë§Œ í¬í•¨ |

---

**ì´ í”ŒëœëŒ€ë¡œ ì§„í–‰í• ê¹Œìš”?**
