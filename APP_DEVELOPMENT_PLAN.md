# 모바일 앱 개발 계획 (상의용)

**작성일:** 2025.12.05  
**상태:** 웹 대시보드 완성, 앱 개발 전 상의 필요

---

## 📋 현재 완료된 웹 기능

### ✅ 완료된 항목
- [x] 인증 시스템 (로그인/회원가입/구글 OAuth)
- [x] 고객 관리 (그룹, 태그, CSV 업로드)
- [x] 문자 발송 UI (단건/다중/그룹/태그, 템플릿, 예약, 이미지 첨부, 이모티콘)
- [x] 발송 기록 조회
- [x] 메시지 템플릿 관리
- [x] 이미지 관리 (명함, 로고 등)
- [x] AI 메시지 추천
- [x] 대화 요약
- [x] 개인정보 상세 입력
- [x] 명함 설정
- [x] 콜백 서비스 설정
- [x] 기본 설정 (업종, 일일 한도, 스로틀링 간격)
- [x] 알림 설정 (푸시 알림, 생일/기념일 알림)
- [x] 오늘의 할 일 대시보드 (생일/기념일 자동 감지)

---

## 📱 모바일 앱 개발 전 상의 사항

### 1. 푸시 알림 기능 ⭐⭐⭐

#### 웹에서 설정 완료:
- ✅ 알림 활성화/비활성화
- ✅ 알림 시간 설정
- ✅ 생일/기념일 알림 시점 설정 (D-0, D-1, D-3, D-7)
- ✅ 작업 완료 알림 설정

#### 앱에서 구현 필요:
- [ ] **푸시 알림 서비스 연동**
  - Firebase Cloud Messaging (FCM) 또는 Expo Push Notifications
  - 토큰 등록 및 관리
  - 백그라운드 알림 수신

- [ ] **알림 트리거 로직**
  - 매일 설정된 시간에 알림 발송
  - 생일/기념일 D-Day 계산
  - 작업 완료 시 알림

- [ ] **알림 내용**
  - 생일 알림: "오늘은 {고객명}님의 생일입니다! 축하 문자를 보내세요."
  - 기념일 알림: "오늘은 {고객명}님과의 {N}주년 기념일입니다!"
  - 작업 완료 알림: "{N}개의 문자 발송이 완료되었습니다."

#### 상의 필요 사항:
1. **푸시 알림 서비스 선택**
   - Firebase Cloud Messaging (FCM) - 안드로이드 기본
   - Expo Push Notifications - Expo 사용 시
   - 직접 구현 vs 서비스 사용

2. **알림 발송 방식**
   - 웹에서 Supabase Function으로 스케줄링?
   - 모바일 앱에서 로컬 알림?
   - 하이브리드 방식?

3. **알림 권한 및 UX**
   - 앱 설치 시 권한 요청 타이밍
   - 알림 설정 화면 위치
   - 알림 클릭 시 동작 (앱 열기, 특정 페이지 이동)

---

### 2. 오늘의 할 일 대시보드 연동

#### 웹에서 완료:
- ✅ 오늘 생일인 고객 자동 감지
- ✅ 오늘 기념일인 고객 자동 감지
- ✅ 대시보드에 특별한 날 카드 표시
- ✅ 바로 문자 보내기 링크

#### 앱에서 구현 필요:
- [ ] **홈 화면에 오늘의 할 일 표시**
  - 생일/기념일 목록
  - 발송 대기 중인 작업 목록
  - 빠른 액션 버튼

- [ ] **알림과 연동**
  - 알림 클릭 시 해당 고객 상세 페이지로 이동
  - 바로 문자 보내기 화면으로 이동

#### 상의 필요 사항:
1. **앱 홈 화면 디자인**
   - 웹과 동일한 레이아웃?
   - 모바일에 최적화된 카드 형태?
   - 스와이프 제스처 지원?

2. **우선순위 표시**
   - 생일/기념일이 더 위에?
   - 발송 대기 작업이 더 위에?
   - 사용자 설정 가능?

---

### 3. 스마트 콜백 기능

#### 웹에서 설정 완료:
- ✅ 콜백 활성화/비활성화
- ✅ 신규 고객 콜백 템플릿
- ✅ 기존 고객 콜백 템플릿
- ✅ 템플릿 변수 지원

#### 앱에서 구현 필요:
- [ ] **통화 종료 감지**
  - `react-native-call-detection` 라이브러리 사용
  - 백그라운드에서도 동작해야 함

- [ ] **고객 DB 조회**
  - 전화번호로 고객 검색
  - 신규/기존 고객 판별

- [ ] **템플릿 적용 및 발송**
  - 설정된 템플릿 읽기
  - 변수 치환 ({고객명}, {이름}, {회사명} 등)
  - 자동 발송 또는 확인 후 발송?

#### 상의 필요 사항:
1. **자동 발송 vs 확인 후 발송**
   - 완전 자동 발송?
   - 알림 후 사용자 확인?
   - 설정에서 선택 가능?

2. **발송 타이밍**
   - 통화 종료 즉시?
   - 몇 분 후?
   - 설정 가능?

3. **에러 처리**
   - 고객을 찾을 수 없을 때?
   - 템플릿이 없을 때?
   - 발송 실패 시?

---

### 4. 스로틀링 큐 시스템

#### 웹에서 설정 완료:
- ✅ 스로틀링 간격 설정 (기본 15초)
- ✅ 일일 한도 모드 선택 (안전 199건 / 최대 490건)

#### 앱에서 구현 필요:
- [ ] **큐 관리 시스템**
  - 대기 중인 작업을 큐에 저장
  - 설정된 간격으로 하나씩 처리
  - 실패 시 재시도 로직

- [ ] **일일 한도 제어**
  - `daily_limits` 테이블과 동기화
  - 한도 초과 시 자동 차단
  - 사용자에게 알림

#### 상의 필요 사항:
1. **큐 저장 방식**
   - 로컬 스토리지 (AsyncStorage)?
   - Supabase 실시간 구독?
   - 하이브리드?

2. **백그라운드 처리**
   - 앱이 백그라운드에 있을 때도 발송?
   - 배터리 최적화 고려?

3. **재시도 로직**
   - 실패 시 몇 번 재시도?
   - 재시도 간격?
   - 최종 실패 시 처리?

---

### 5. 실제 SMS 발송 처리

#### 앱에서 구현 필요:
- [ ] **SMS 발송**
  - `react-native-get-sms-android` 라이브러리 사용
  - MMS 발송 (이미지 첨부 시)

- [ ] **발송 기록 저장**
  - `sms_logs` 테이블에 기록
  - `tasks` 상태 업데이트
  - `daily_limits` 카운트 증가

- [ ] **에러 처리**
  - 발송 실패 시 로그 기록
  - 사용자에게 알림

#### 상의 필요 사항:
1. **MMS 발송**
   - 이미지 다운로드 및 첨부
   - 이미지 크기 제한?
   - 발송 실패 시 재시도?

2. **발송 확인**
   - 발송 성공 여부 확인 방법?
   - 배달 확인 (선택사항)?

---

## 🎯 앱 개발 우선순위

### Phase 1: 핵심 기능 (필수)
1. **스로틀링 큐 시스템** ⭐⭐⭐
   - 가장 중요! 없으면 통신사 제재 위험
   - 예상 소요: 8-10시간

2. **일일 한도 제어** ⭐⭐⭐
   - 스로틀링과 함께 필수
   - 예상 소요: 4-6시간

3. **실제 SMS 발송 처리** ⭐⭐⭐
   - 기본 기능
   - 예상 소요: 6-8시간

### Phase 2: 스마트 기능
4. **스마트 콜백 로직** ⭐⭐
   - 차별화 포인트
   - 예상 소요: 6-8시간

5. **푸시 알림 기능** ⭐⭐
   - 사용자 경험 향상
   - 예상 소요: 8-10시간

6. **오늘의 할 일 대시보드** ⭐
   - 편의 기능
   - 예상 소요: 4-6시간

---

## 📋 앱 개발 전 체크리스트

### 기술 스택 확인
- [ ] React Native CLI vs Expo 결정
- [ ] 필요한 라이브러리 확인:
  - `react-native-get-sms-android` (SMS 발송)
  - `react-native-call-detection` (통화 감지)
  - `@react-native-async-storage/async-storage` (로컬 저장)
  - `@supabase/supabase-js` (백엔드 연동)
  - FCM 또는 Expo Push Notifications (푸시 알림)

### 권한 설정
- [ ] SMS 발송 권한
- [ ] 통화 감지 권한
- [ ] 백그라운드 작업 권한
- [ ] 알림 권한

### 테스트 계획
- [ ] 실제 안드로이드 디바이스 필요
- [ ] 다양한 통신사 테스트
- [ ] 배터리 소모 테스트
- [ ] 백그라운드 동작 테스트

---

## 💬 상의할 주요 사항

1. **푸시 알림 서비스 선택**
   - FCM vs Expo Push Notifications
   - 비용 및 설정 복잡도

2. **콜백 자동 발송 여부**
   - 완전 자동 vs 확인 후 발송
   - 사용자 선택 가능?

3. **알림 발송 방식**
   - 웹에서 스케줄링 vs 앱에서 로컬 알림
   - Supabase Function 사용 여부

4. **백그라운드 처리**
   - 앱이 꺼져 있어도 발송?
   - 배터리 최적화 전략

5. **에러 처리 및 복구**
   - 네트워크 오류 시 처리
   - 앱 재시작 시 큐 복구

---

## 🚀 다음 단계

1. **상의 완료 후:**
   - 모바일 앱 개발 시작
   - Phase 1부터 순차적으로 구현

2. **개발 중:**
   - 각 기능별 테스트
   - 웹과 앱 연동 확인

3. **완료 후:**
   - 통합 테스트
   - 실제 사용자 테스트
   - 배포 준비

---

**준비 완료! 상의 후 앱 개발을 시작할 수 있습니다.** 🎉

