# 관리자 기능 테스트 가이드

## ✅ 완료된 작업

### 보안 강화 (6/6)
- ✅ API 키 하드코딩 제거
- ✅ 인증 오류 처리 수정
- ✅ 디버그 API 보호
- ✅ 입력 검증 강화
- ✅ 보안 헤더 추가
- ✅ 에러 메시지 일반화

### 관리자 기능 (10/10)
- ✅ 데이터베이스 스키마 생성
- ✅ 관리자 권한 확인 유틸리티
- ✅ 접속 로그 미들웨어
- ✅ 관리자 레이아웃 및 네비게이션
- ✅ 관리자 대시보드 메인 페이지
- ✅ 사용자 관리 페이지
- ✅ 접속 로그 페이지
- ✅ 통계 대시보드 페이지
- ✅ 결산 리포트 페이지 (슈퍼 관리자 전용)
- ✅ 관리자 API 라우트

---

## 🧪 테스트 방법

### 1. 슈퍼 관리자 계정 생성

Supabase Dashboard > SQL Editor에서 실행:

```sql
-- 본인의 user_id를 확인한 후 실행
SELECT create_super_admin('your-user-id-here');
```

또는 직접 삽입:

```sql
INSERT INTO admin_users (user_id, role)
VALUES ('your-user-id-here', 'super_admin');
```

### 2. 관리자 페이지 접근

1. 웹 앱에 로그인
2. `/admin` 경로로 접근
3. 관리자 권한이 있으면 관리자 대시보드 표시
4. 권한이 없으면 일반 대시보드로 리다이렉트

### 3. 테스트 항목

#### 관리자 대시보드 (`/admin`)
- [ ] 전체 통계 카드 표시 확인
- [ ] 최근 가입 사용자 목록 확인
- [ ] 최근 접속 로그 목록 확인

#### 사용자 관리 (`/admin/users`)
- [ ] 사용자 목록 표시 확인
- [ ] 검색 기능 테스트
- [ ] 필터 기능 테스트 (활성/비활성)
- [ ] 사용자 상세 페이지 (`/admin/users/[id]`) 확인

#### 접속 로그 (`/admin/access-logs`)
- [ ] 접속 로그 목록 표시 확인
- [ ] 필터 기능 테스트 (경로, 메서드, 기간)
- [ ] 통계 카드 확인
- [ ] IP 주소, User-Agent 표시 확인

#### 통계 대시보드 (`/admin/statistics`)
- [ ] 기간 선택 기능 테스트
- [ ] 통계 카드 표시 확인
- [ ] 커스텀 기간 선택 테스트

#### 결산 리포트 (`/admin/finance`)
- [ ] 슈퍼 관리자만 접근 가능 확인
- [ ] 구독 통계 표시 확인
- [ ] 수익 통계 표시 확인
- [ ] 플랜별 분포 확인

### 4. 권한 테스트

#### 일반 관리자
- [ ] `/admin` 접근 가능
- [ ] `/admin/finance` 접근 불가 (리다이렉트)

#### 슈퍼 관리자
- [ ] `/admin` 접근 가능
- [ ] `/admin/finance` 접근 가능
- [ ] 결산 메뉴 표시 확인

#### 일반 사용자
- [ ] `/admin` 접근 불가 (리다이렉트)

### 5. 접속 로그 기록 확인

1. 여러 페이지 방문
2. `/admin/access-logs`에서 로그 확인
3. IP 주소, 경로, 메서드가 정확히 기록되는지 확인

---

## 🐛 알려진 제한사항

1. **사용자 이메일 표시**
   - 현재는 `customers` 테이블에서 user_id를 추출하여 표시
   - 실제 이메일은 `auth.users` 테이블에서 가져와야 함
   - Service Role Key를 사용하거나 별도 API 필요

2. **접속 로그 미들웨어**
   - 정적 파일과 일부 경로는 제외됨
   - API 라우트의 정확한 상태 코드는 별도 API로 기록 필요

3. **통계 데이터**
   - 일부 통계는 `customers` 테이블 기반으로 추정
   - 정확한 사용자 수는 `auth.users` 직접 조회 필요

---

## 📝 다음 단계

1. **Service Role Key 활용**
   - `auth.users` 테이블 직접 조회
   - 정확한 사용자 정보 표시

2. **API 라우트 개선**
   - 관리자 전용 API 엔드포인트 추가
   - 더 정확한 통계 데이터 제공

3. **차트 시각화**
   - Recharts 라이브러리 추가
   - 통계 데이터 시각화

---

## ✅ 빌드 상태

- ✅ TypeScript 컴파일 성공
- ✅ 모든 페이지 정상 생성
- ✅ 미들웨어 정상 작동

---

**테스트 완료 후 알려주세요!**


