# 작업 일지 - 2025년 12월 8일

## 작업 날짜
**2025년 12월 8일 (일요일)**

---

## 주요 작업 내용

### 1. BizConnect 마스터 플랜 수립
**파일**: `BIZCONNECT_MASTER_PLAN.md`

- AI 콜백 서비스의 핵심 콘셉트 정의
- 경쟁사 분석 (알리다, 알리오 콜백, 스마트콜백)
- 카테고리별 발송 설정 정리 (가족/친구 제외, 거래처/VIP는 AI 맞춤)
- 웹 vs 앱 역할 분담 정의
- 개발 로드맵 Phase 1~4 작성
- 수익 모델 설계 (무료/프로/비즈니스)

---

### 2. 자동 로그인 기능 구현
**파일**: `mobile/lib/supabaseClient.ts`

#### 변경 내용
```typescript
// 변경 전
export const supabase = createClient(supabaseUrl, supabaseAnonKey, {
    auth: {
        storage: null,
        autoRefreshToken: true,
        persistSession: false,
        detectSessionInUrl: false,
    },
})

// 변경 후
import AsyncStorage from '@react-native-async-storage/async-storage'

export const supabase = createClient(supabaseUrl, supabaseAnonKey, {
    auth: {
        storage: AsyncStorage,
        autoRefreshToken: true,
        persistSession: true,
        detectSessionInUrl: false,
    },
})
```

#### 효과
- 앱 종료 후 재실행 시 로그인 상태 유지
- AsyncStorage를 통한 세션 영속화
- 자동 토큰 갱신 기능 활성화

---

### 3. 웹 설정 바로가기 버튼 추가
**파일**: `mobile/src/screens/HomeScreen.tsx`

#### 추가된 코드
```typescript
import { Linking } from 'react-native';

// 버튼 추가
<TouchableOpacity
  style={styles.webSettingsButton}
  onPress={() => Linking.openURL('https://bizconnect-web.vercel.app')}
>
  <Text style={styles.webSettingsButtonText}>웹에서 상세 설정</Text>
</TouchableOpacity>
```

#### 효과
- 앱에서 버튼 클릭 시 웹 대시보드로 바로 이동
- 복잡한 설정은 웹에서 처리하는 역할 분담 실현

---

### 4. Android Release APK 빌드 및 설치
**빌드 방법** (상세한 과정은 아래 "빌드 가이드" 참조)

1. `build-release.cmd` 스크립트 생성 및 실행
2. APK 생성 경로: `mobile/android/app/build/outputs/apk/release/app-release.apk`
3. ADB를 통해 Galaxy S8에 설치 성공

---

## Android Release APK 빌드 가이드

### 환경 요구사항
- **JDK**: Java 17 (경로: `C:\Java\jdk-17.0.13+11`)
- **Android SDK**: `C:\AndroidSdk`
- **Node.js**: 설치 필요
- **Gradle**: 프로젝트 내장 wrapper 사용

### 빌드 방법 1: 스크립트 사용 (권장)

```cmd
# build-release.cmd 파일 실행
C:\call\mobile\build-release.cmd
```

**build-release.cmd 내용:**
```cmd
@echo off
set JAVA_HOME=C:\Java\jdk-17.0.13+11
set PATH=%JAVA_HOME%\bin;%PATH%
cd /d C:\call\mobile\android
call C:\call\mobile\android\gradlew.bat assembleRelease --no-daemon -PreactNativeArchitectures=arm64-v8a
```

### 빌드 방법 2: PowerShell 직접 실행

```powershell
# PowerShell에서 환경변수 설정 후 빌드
$env:JAVA_HOME = "C:\Java\jdk-17.0.13+11"
$env:Path = "$env:JAVA_HOME\bin;$env:Path"
cd C:\call\mobile\android
.\gradlew.bat assembleRelease --no-daemon -PreactNativeArchitectures=arm64-v8a
```

### 빌드 결과물
- **위치**: `C:\call\mobile\android\app\build\outputs\apk\release\app-release.apk`
- **크기**: 약 20MB (arm64-v8a만 포함 시)

### 기기 설치 방법

```powershell
# 1. 연결된 기기 확인
& 'C:\AndroidSdk\platform-tools\adb.exe' devices

# 2. APK 설치
& 'C:\AndroidSdk\platform-tools\adb.exe' install -r 'C:\call\mobile\android\app\build\outputs\apk\release\app-release.apk'

# 3. 앱 실행
& 'C:\AndroidSdk\platform-tools\adb.exe' shell am start -n com.bizconnectmobile/.MainActivity
```

### 주요 Gradle 설정
**파일**: `mobile/android/gradle.properties`

```properties
# Java 경로 설정 (JAVA_HOME 없어도 사용)
org.gradle.java.home=C:\\Java\\jdk-17.0.13+11

# 한국어 경로 인코딩 문제 방지
gradle.user.home=C:\\call\\gradle_cache

# 메모리 설정
org.gradle.jvmargs=-Xmx2048m -XX:MaxMetaspaceSize=512m
```

### 트러블슈팅

1. **JAVA_HOME not set 에러**
   - `gradle.properties`에 `org.gradle.java.home` 설정 확인
   - 또는 빌드 스크립트에서 환경변수 직접 설정

2. **한국어 경로 인코딩 에러**
   - `gradle.user.home=C:\\call\\gradle_cache` 설정으로 해결

3. **빌드 시간이 너무 오래 걸림**
   - `--no-daemon` 옵션으로 데몬 비활성화
   - `-PreactNativeArchitectures=arm64-v8a`로 단일 아키텍처만 빌드

---

## 수정된 파일 목록

| 파일 | 변경 내용 |
|------|----------|
| `BIZCONNECT_MASTER_PLAN.md` | 새로 생성 - 마스터 플랜 문서 |
| `mobile/lib/supabaseClient.ts` | AsyncStorage 연동, persistSession 활성화 |
| `mobile/src/screens/HomeScreen.tsx` | 웹 설정 버튼 추가, Linking import |
| `mobile/build-release.cmd` | 새로 생성 - 빌드 스크립트 |

---

## 테스트 결과

### 자동 로그인 테스트
1. 앱 실행 → 로그인
2. 앱 완전 종료 (최근 앱에서 제거)
3. 앱 다시 실행 → **자동으로 대시보드 표시됨**

### 웹 설정 버튼 테스트
1. 대시보드에서 "웹에서 상세 설정" 버튼 클릭
2. **브라우저에서 https://bizconnect-web.vercel.app 열림**

---

## 다음 작업 예정

### Phase 1 (다음 작업)
- [ ] 앱 콜백 설정 화면 구현 (ON/OFF, 카테고리별 설정)
- [ ] 기본 인사말 편집 기능
- [ ] 콜백 자동 발송 로직 구현

### Phase 2
- [ ] AI 맞춤 문자 API 연동
- [ ] 발송 이력 저장 및 표시

---

**작성일**: 2025년 12월 8일
**작성자**: Claude Code
**버전**: 1.1.0
