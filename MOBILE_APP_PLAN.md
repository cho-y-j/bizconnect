# 📱 BizConnect 모바일 앱 개발 기획서

**작성일**: 2025년 1월 27일  
**버전**: 1.0.0  
**목표**: 웹 대시보드와 연동되는 완전한 기능의 모바일 앱 개발

---

## 📋 목차

1. [프로젝트 개요](#프로젝트-개요)
2. [아키텍처 설계](#아키텍처-설계)
3. [기능 명세](#기능-명세)
4. [데이터 흐름](#데이터-흐름)
5. [UI/UX 디자인](#uiux-디자인)
6. [기술 스택](#기술-스택)
7. [개발 일정](#개발-일정)
8. [리스크 관리](#리스크-관리)

---

## 🎯 프로젝트 개요

### 목적
BizConnect는 웹 대시보드에서 생성한 SMS 발송 작업을 모바일 앱에서 실제로 처리하는 시스템입니다. 웹에서는 작업을 생성하고, 모바일 앱은 백그라운드에서 자동으로 SMS를 발송합니다.

### 핵심 가치
1. **자동화**: 웹에서 설정한 작업을 자동으로 처리
2. **안전성**: 스로틀링과 일일 한도로 통신사 제재 방지
3. **스마트**: 통화 후 자동 콜백 문자 발송
4. **편의성**: 백그라운드에서 자동 실행

### 타겟 사용자
- 영업 담당자
- 고객 관리자
- 마케팅 담당자
- 소상공인

---

## 🏗️ 아키텍처 설계

### 시스템 구조

```
┌─────────────────┐
│   웹 대시보드    │
│  (Next.js)      │
└────────┬────────┘
         │
         │ 1. 작업 생성 (tasks 테이블)
         ▼
┌─────────────────┐
│   Supabase      │
│   (PostgreSQL)  │
│                 │
│  - tasks        │
│  - customers    │
│  - sms_logs     │
│  - daily_limits │
└────────┬────────┘
         │
         │ 2. 실시간 구독
         ▼
┌─────────────────┐
│  모바일 앱      │
│ (React Native)  │
│                 │
│  - 큐 관리       │
│  - SMS 발송     │
│  - 통화 감지    │
└────────┬────────┘
         │
         │ 3. 발송 결과 저장
         ▼
┌─────────────────┐
│   Supabase      │
│   (업데이트)     │
└─────────────────┘
```

### 컴포넌트 구조

```
mobile/
├── src/
│   ├── screens/
│   │   ├── HomeScreen.tsx          # 홈 화면
│   │   ├── LoginScreen.tsx          # 로그인
│   │   ├── SendSmsScreen.tsx        # 문자 보내기
│   │   ├── CustomersScreen.tsx      # 고객 관리
│   │   ├── HistoryScreen.tsx        # 발송 기록
│   │   └── SettingsScreen.tsx       # 설정
│   ├── components/
│   │   ├── TaskCard.tsx             # 작업 카드
│   │   ├── CustomerCard.tsx          # 고객 카드
│   │   └── StatsCard.tsx            # 통계 카드
│   ├── lib/
│   │   ├── smsQueue.ts              # 큐 관리
│   │   ├── dailyLimit.ts            # 한도 관리
│   │   ├── smsSender.ts             # SMS 발송
│   │   ├── callbackManager.ts       # 콜백 관리
│   │   └── supabaseClient.ts        # Supabase 클라이언트
│   ├── hooks/
│   │   ├── useTasks.ts              # 작업 훅
│   │   ├── useCustomers.ts          # 고객 훅
│   │   └── useAuth.ts               # 인증 훅
│   └── utils/
│       ├── permissions.ts            # 권한 관리
│       └── notifications.ts          # 알림 관리
├── App.tsx                           # 메인 앱
└── package.json
```

---

## 📱 기능 명세

### 1. 인증 시스템

#### 1.1 로그인
- **기능**: 이메일/비밀번호 로그인
- **구현**: Supabase Auth
- **화면**: LoginScreen.tsx
- **플로우**:
  1. 사용자가 이메일/비밀번호 입력
  2. Supabase Auth로 인증
  3. 세션 저장 (AsyncStorage)
  4. 홈 화면으로 이동

#### 1.2 자동 로그인
- **기능**: 앱 재시작 시 자동 로그인
- **구현**: 저장된 세션 확인
- **플로우**:
  1. 앱 시작 시 세션 확인
  2. 유효한 세션이면 자동 로그인
  3. 만료된 세션이면 로그인 화면

#### 1.3 로그아웃
- **기능**: 로그아웃 및 세션 삭제
- **구현**: Supabase Auth 로그아웃

---

### 2. 스로틀링 큐 시스템

#### 2.1 큐 관리
- **목적**: 통신사 제재 방지 (15초 간격 발송)
- **구현**: `smsQueue.ts`
- **기능**:
  - 작업 추가/제거
  - 우선순위 처리
  - 상태 관리 (대기/처리중/완료/실패)
  - 로컬 저장 (AsyncStorage)
  - 앱 재시작 시 복구

#### 2.2 스로틀링 로직
```typescript
// 의사코드
while (queue.hasItems()) {
  const task = queue.getNext();
  await sendSms(task);
  await wait(15 seconds); // 스로틀링
  updateTaskStatus(task);
}
```

#### 2.3 예약 발송
- **기능**: `scheduled_at` 시간 도래 시 자동 발송
- **구현**: 예약 시간 확인 후 큐에 추가

---

### 3. 일일 한도 제어

#### 3.1 한도 조회
- **소스**: `daily_limits` 테이블
- **모드**: 
  - 안전 모드: 199건/일
  - 최대 모드: 490건/일

#### 3.2 한도 체크
- **시점**: 큐에 추가 전
- **로직**:
  1. 오늘 발송 건수 조회
  2. 한도와 비교
  3. 초과 시 큐 추가 차단

#### 3.3 한도 업데이트
- **시점**: 발송 성공 후
- **로직**: `sent_count` 증가

---

### 4. SMS 발송 처리

#### 4.1 기본 SMS 발송
- **라이브러리**: `react-native-get-sms-android`
- **기능**:
  - 전화번호 유효성 검사
  - 메시지 길이 체크
  - 발송 실행
  - 성공/실패 처리

#### 4.2 MMS 발송 (이미지 첨부)
- **기능**: 이미지 포함 문자 발송
- **프로세스**:
  1. Supabase Storage에서 이미지 다운로드
  2. 이미지 크기 최적화
  3. MMS 발송

#### 4.3 발송 기록
- **저장 위치**: `sms_logs` 테이블
- **저장 정보**:
  - 전화번호
  - 메시지 내용
  - 발송 시간
  - 상태 (sent/failed)
  - 에러 메시지 (실패 시)

---

### 5. 스마트 콜백 기능

#### 5.1 통화 감지
- **라이브러리**: `react-native-call-detection`
- **기능**: 통화 종료 감지
- **백그라운드**: 앱이 꺼져 있어도 동작

#### 5.2 고객 조회
- **프로세스**:
  1. 통화 종료 시 전화번호 추출
  2. `customers` 테이블에서 검색
  3. 신규/기존 고객 판별

#### 5.3 템플릿 적용
- **소스**: `user_settings` 테이블
- **템플릿**:
  - 신규 고객: `callback_template_new`
  - 기존 고객: `callback_template_existing`
- **변수 치환**: `{고객명}`, `{이름}` 등

#### 5.4 발송 처리
- **옵션**:
  - 자동 발송 (설정에 따라)
  - 확인 후 발송 (알림 표시)

---

### 6. 홈 화면 및 대시보드

#### 6.1 오늘의 할 일
- **내용**:
  - 오늘 생일인 고객
  - 오늘 기념일인 고객
  - 발송 대기 중인 작업

#### 6.2 통계 카드
- **내용**:
  - 오늘 발송 건수
  - 성공/실패 비율
  - 일일 한도 사용률

#### 6.3 빠른 액션
- **버튼**:
  - 문자 보내기
  - 고객 관리
  - 발송 기록

---

### 7. 푸시 알림

#### 7.1 알림 타입
- 생일/기념일 알림 (D-0, D-1, D-3, D-7)
- 작업 완료 알림
- 한도 초과 알림

#### 7.2 알림 처리
- 포그라운드/백그라운드 알림
- 딥링크 (특정 화면으로 이동)

---

## 🔄 데이터 흐름

### 작업 생성 → 발송 플로우

```
1. 웹에서 작업 생성
   ↓
2. tasks 테이블에 INSERT (status: 'pending')
   ↓
3. 모바일 앱이 실시간 구독으로 감지
   ↓
4. 큐에 작업 추가
   ↓
5. 일일 한도 체크
   ↓
6. 스로틀링 (15초 간격)
   ↓
7. SMS 발송
   ↓
8. sms_logs에 기록
   ↓
9. tasks 상태 업데이트 ('completed')
   ↓
10. daily_limits 카운트 증가
```

### 스마트 콜백 플로우

```
1. 통화 종료 감지
   ↓
2. 전화번호 추출 및 정규화
   ↓
3. customers 테이블에서 검색
   ↓
4. 신규/기존 고객 판별
   ↓
5. user_settings에서 템플릿 조회
   ↓
6. 변수 치환
   ↓
7. 자동 발송 또는 확인 후 발송
   ↓
8. tasks 테이블에 'callback' 타입으로 저장
   ↓
9. sms_logs에 기록
```

---

## 🎨 UI/UX 디자인

### 디자인 원칙
1. **단순성**: 복잡한 기능도 쉽게 사용
2. **명확성**: 상태와 정보를 명확히 표시
3. **일관성**: 웹과 모바일의 일관된 경험
4. **접근성**: 모든 사용자가 쉽게 사용

### 주요 화면

#### 홈 화면
```
┌─────────────────────┐
│  BizConnect         │
│  오늘의 할 일       │
├─────────────────────┤
│  🎂 생일            │
│  홍길동님           │
│  [축하 문자 보내기] │
├─────────────────────┤
│  📊 통계            │
│  오늘 발송: 15건    │
│  성공률: 100%       │
│  한도: 15/199       │
├─────────────────────┤
│  빠른 액션          │
│  [문자 보내기]      │
│  [고객 관리]        │
└─────────────────────┘
```

#### 작업 목록 화면
```
┌─────────────────────┐
│  발송 대기 작업     │
├─────────────────────┤
│  📱 일반 문자       │
│  홍길동 (010-1234)  │
│  안녕하세요...      │
│  [지금 보내기]      │
├─────────────────────┤
│  🎂 생일 축하       │
│  김철수 (010-5678)  │
│  생일 축하드립니다  │
│  [지금 보내기]      │
└─────────────────────┘
```

---

## 🛠️ 기술 스택

### 프론트엔드
- **React Native**: 0.73.0
- **TypeScript**: 5.0.4
- **React Navigation**: 화면 네비게이션

### 백엔드 연동
- **Supabase JS**: 2.39.0
  - PostgreSQL (데이터베이스)
  - Auth (인증)
  - Realtime (실시간 구독)
  - Storage (이미지 저장)

### 네이티브 기능
- **react-native-get-sms-android**: SMS 발송
- **react-native-call-detection**: 통화 감지
- **@react-native-async-storage/async-storage**: 로컬 저장
- **react-native-permissions**: 권한 관리
- **react-native-background-actions**: 백그라운드 작업

### 푸시 알림
- **Firebase Cloud Messaging (FCM)**: 푸시 알림

### 개발 도구
- **ESLint**: 코드 품질
- **Prettier**: 코드 포맷팅
- **Jest**: 테스트

---

## 📅 개발 일정

### Week 1-2: Phase 1 (핵심 기능)
- 프로젝트 설정
- 인증 시스템
- 스로틀링 큐
- 일일 한도
- SMS 발송
- 실시간 구독

### Week 2-3: Phase 2 (스마트 기능)
- 스마트 콜백
- 홈 화면
- 푸시 알림

### Week 3-4: Phase 3 (고급 기능)
- 백그라운드 처리
- 오프라인 지원
- 성능 최적화
- 에러 처리

### Week 4: Phase 4 (배포 준비)
- UI/UX 개선
- 보안 강화
- 문서화
- 배포

---

## ⚠️ 리스크 관리

### 기술적 리스크

#### 1. SMS 발송 실패
- **리스크**: 안드로이드 버전별 호환성 문제
- **대응**: 다양한 디바이스 테스트, 재시도 로직

#### 2. 백그라운드 작업 제한
- **리스크**: 안드로이드 배터리 최적화로 백그라운드 작업 제한
- **대응**: 포그라운드 서비스 사용, 사용자 가이드 제공

#### 3. 통신사 제재
- **리스크**: 과도한 발송으로 인한 제재
- **대응**: 스로틀링 필수, 일일 한도 준수

### 비즈니스 리스크

#### 1. 사용자 권한 거부
- **리스크**: SMS 권한 거부 시 앱 사용 불가
- **대응**: 명확한 권한 설명, 단계별 권한 요청

#### 2. 배터리 소모
- **리스크**: 백그라운드 작업으로 인한 배터리 소모
- **대응**: 효율적인 타이머 사용, 배터리 최적화

---

## 📊 성공 지표

### 기능 지표
- [ ] 큐 처리 성공률: 99% 이상
- [ ] SMS 발송 성공률: 95% 이상
- [ ] 앱 크래시율: 0.1% 이하

### 성능 지표
- [ ] 앱 시작 시간: 2초 이하
- [ ] 작업 처리 지연: 15초 이하
- [ ] 배터리 소모: 최소화

### 사용자 경험
- [ ] 사용자 만족도: 4.5/5 이상
- [ ] 앱 평점: 4.5/5 이상
- [ ] 이탈률: 10% 이하

---

## 🔐 보안 고려사항

### 데이터 보안
- Supabase RLS로 사용자별 데이터 격리
- 토큰 안전 저장 (AsyncStorage 암호화)
- API 키 환경 변수 관리

### 권한 관리
- 최소 권한 원칙
- 권한 설명 명확화
- 권한 거부 시 대안 제공

---

## 📝 다음 단계

1. **기획 검토**: 이 문서 검토 및 승인
2. **기술 검토**: 기술 스택 및 아키텍처 검토
3. **디자인**: UI/UX 디자인 완성
4. **개발 시작**: Phase 1부터 순차 개발

---

**작성자**: 개발팀  
**검토자**: (대기)  
**승인자**: (대기)  
**다음 업데이트**: Phase 1 완료 후




